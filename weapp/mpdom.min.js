function __importDefault(e){return e&&e.__esModule?e:{default:e}}function __awaiter(e,t,i,s){return new(i||(i=Promise))((function(o,n){function r(e){try{l(s.next(e))}catch(e){n(e)}}function a(e){try{l(s.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}l((s=s.apply(e,t||[])).next())}))}!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).MPDOM=e()}}((function(){var define,module,exports;return function e(t,i,s){function o(r,a){if(!i[r]){if(!t[r]){var l="function"==typeof require&&require;if(!a&&l)return l(r,!0);if(n)return n(r,!0);var d=new Error("Cannot find module '"+r+"'");throw d.code="MODULE_NOT_FOUND",d}var c=i[r]={exports:{}};t[r][0].call(c.exports,(function(e){return o(t[r][1][e]||e)}),c,c.exports,e,t,i,s)}return i[r].exports}for(var n="function"==typeof require&&require,r=0;r<s.length;r++)o(s[r]);return o}({1:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.BrowserApp=void 0;const s=e("./page"),o=e("./router");class n{constructor(e,t){this.rootElement=e,this.engine=t,this.router=new r(this.engine),t.app=this,this.setupPageScrollListener()}setupPageScrollListener(){document.addEventListener("scroll",(()=>{var e;if(document.documentElement.scrollHeight>innerHeight&&window.pageYOffset+innerHeight>=document.documentElement.scrollHeight){let t=(null===(e=this.engine.app)||void 0===e?void 0:e.router).history;t[t.length-1].item.onReachBottom()}}))}getURLSearchParams(){try{let e={},t=new URL(window.location.href).searchParams;const i=t.keys();let s=i.next();for(;!s.done&&(e[s.value]=t.get(s.value),s=i.next(),!s.done););return e}catch(e){return console.error(e),{}}}setupFirstPage(e,t){var i,o;return __awaiter(this,void 0,void 0,(function*(){if(!e)if(this.router.isPathRewriteEnabled)e={route:new URL(window.location.href).pathname||"/",params:this.getURLSearchParams()};else{let t=Object.assign({},this.getURLSearchParams());delete t.route,e={route:new URL(window.location.href).searchParams.get("route")||"/",params:t}}const n=new s.Page(this.rootElement,this.engine,e);n.isFirst=!0,t?(this.router.history.forEach((e=>e.item.active=!1)),this.router.history[0]={item:n,scrollPosition:0}):this.router.history.push({item:n,scrollPosition:0}),yield n.ready(),this.router.didSetupFirst(n.viewId,null!==(i=null==e?void 0:e.route)&&void 0!==i?i:"/",null!==(o=null==e?void 0:e.params)&&void 0!==o?o:{})}))}enablePathRewrite(){this.router.isPathRewriteEnabled=!0}}i.BrowserApp=n;class r extends o.Router{constructor(e){super(e),this.history=[],this.isPathRewriteEnabled=!1,this.doBacking=!1,window.addEventListener("popstate",(e=>{if(this.doBacking)return!0;if(window.history.state&&window.history.state.routeId){let e=window.history.state.routeId;this.history.length>1?(this.popHistory(),this.engine.sendMessage(JSON.stringify({type:"router",message:{event:"popToRoute",routeId:e}}))):this.engine.app&&this.engine.app instanceof n&&this.engine.app.setupFirstPage(void 0,!0)}}))}encodePath(e,t){let i=[];if(t)for(const e in t)i.push(`${e}=${encodeURIComponent(t[e])}`);if(this.isPathRewriteEnabled)return i.length>0?`${e}?${i.join("&")}`:`${e}`;{const t=e.indexOf("?")>=0?e.split("?")[0]:e,s=e.indexOf("?")>=0?e.substr(e.indexOf("?")):"";return i.length>0?`?route=${encodeURI(t)}${encodeURIComponent(s)}&${i.join("&")}`:`?route=${encodeURI(t)}${encodeURIComponent(s)}`}}didSetupFirst(e,t,i){window.history.replaceState({routeId:e},"",this.encodePath(t,i))}didPush(e){const t=e.routeId;this.thePushingRouteId=t;const i=e.name;window.history.pushState({routeId:t},"",this.encodePath(i,e.params));const o=window.pageYOffset,n=new s.Page(this.engine.app.rootElement,this.engine);this.pushHistory(n,o)}didReplace(e){const t=e.routeId;this.thePushingRouteId=t;const i=e.name;window.history.replaceState({routeId:t},"",this.encodePath(i,e.params));const o=new s.Page(this.engine.app.rootElement,this.engine);this.replaceHistory(o)}didPop(){this.doBacking=!0,window.history.back(),this.popHistory(),setTimeout((()=>{this.doBacking=!1}),100)}pushHistory(e,t){this.history.forEach((e=>e.item.active=!1)),this.history.push({item:e,scrollPosition:t}),window.scrollTo(0,0)}replaceHistory(e){this.history.forEach((e=>e.item.active=!1)),this.history[this.history.length-1]={item:e,scrollPosition:0},window.scrollTo(0,0)}popHistory(){this.history.length<=1||(this.history.pop().item.active=!1,this.history[this.history.length-1].item.active=!0,window.scrollTo(0,this.history[this.history.length-1].scrollPosition))}}},{"./page":45,"./router":46}],2:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AbsorbPointer=void 0;const s=e("../../env"),o=e("../component_view"),n=e("./gesture_detector");class r extends o.ComponentView{constructor(){super(...arguments),this.didSetListener=!1}elementType(){return"div"}setAttributes(e){super.setAttributes(e),this.didSetListener||(this.didSetListener=!0,s.MPEnv.platformType===s.PlatformType.browser?(this.htmlElement.addEventListener("click",(e=>{e.stopPropagation()})),this.htmlElement.addEventListener("touchstart",(e=>{n.GestureDetector.activeTouchElement=void 0}))):this.htmlElement.addEventListener("click",(e=>{e.stopPropagation()})))}}i.AbsorbPointer=r},{"../../env":40,"../component_view":27,"./gesture_detector":12}],3:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ClipOval=void 0;const s=e("../component_view"),o=e("../dom_utils");class n extends s.ComponentView{setAttributes(e){super.setAttributes(e),(0,o.setDOMStyle)(this.htmlElement,{borderRadius:"50%",overflow:"hidden"})}}i.ClipOval=n},{"../component_view":27,"../dom_utils":29}],4:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ClipRRectAncestor=i.ClipRRect=void 0;const s=e("../component_view"),o=e("../dom_utils"),n=e("../utils");class r extends s.ComponentView{setAttributes(e){var t,i,s,r,a;super.setAttributes(e);const l=e.borderRadius?(0,n.cssBorderRadius)(e.borderRadius):{};l.borderRadius?(0,o.setDOMStyle)(this.htmlElement,{borderRadius:null!==(t=l.borderRadius)&&void 0!==t?t:"unset",overflow:"hidden"}):(0,o.setDOMStyle)(this.htmlElement,{borderTopLeftRadius:null!==(i=l.borderTopLeftRadius)&&void 0!==i?i:"unset",borderTopRightRadius:null!==(s=l.borderTopRightRadius)&&void 0!==s?s:"unset",borderBottomLeftRadius:null!==(r=l.borderBottomLeftRadius)&&void 0!==r?r:"unset",borderBottomRightRadius:null!==(a=l.borderBottomRightRadius)&&void 0!==a?a:"unset",overflow:"hidden"})}}i.ClipRRect=r;class a extends s.AncestorView{setAttributes(e){var t,i,s,o,r;super.setAttributes(e),this.target.ancestorStyle.opacity||(this.target.ancestorStyle.opacity=1);const a=e.borderRadius?(0,n.cssBorderRadius)(e.borderRadius):{};a.borderRadius?(this.target.ancestorStyle.borderRadius=null!==(t=a.borderRadius)&&void 0!==t?t:"unset",this.target.ancestorStyle.overflow="hidden"):(this.target.ancestorStyle.borderTopLeftRadius=null!==(i=a.borderTopLeftRadius)&&void 0!==i?i:"unset",this.target.ancestorStyle.borderTopRightRadius=null!==(s=a.borderTopRightRadius)&&void 0!==s?s:"unset",this.target.ancestorStyle.borderBottomLeftRadius=null!==(o=a.borderBottomLeftRadius)&&void 0!==o?o:"unset",this.target.ancestorStyle.borderBottomRightRadius=null!==(r=a.borderBottomRightRadius)&&void 0!==r?r:"unset",this.target.ancestorStyle.overflow="hidden")}}i.ClipRRectAncestor=a},{"../component_view":27,"../dom_utils":29,"../utils":37}],5:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.CollectionViewLayout=i.CollectionView=void 0;const s=e("../../env"),o=e("../component_view"),n=e("../dom_utils"),r=e("../utils"),a=e("./sliver_persistent_header");class l extends o.ComponentView{constructor(e,t){super(e,t),this.initialAttributes=t,this.classname="CollectionView",this.wrapperHtmlElement=this.document.createElement("div"),this.appBarPinnedViews=[],this.appBarPersistentHeight=0,this.enabledRestoration=!1,this.lastScrollX=0,this.lastScrollY=0,this.viewWidth=0,this.viewHeight=0,this.bottomBarHeight=0,this.bottomBarWithSafeArea=!1,this.didAddScrollListener=!1,this.htmlElement.appendChild(this.wrapperHtmlElement)}elementType(){var e,t,i;return!(null===(e=this.initialAttributes)||void 0===e?void 0:e.restorationId)&&!(null===(t=this.initialAttributes)||void 0===t?void 0:t.onScroll)||s.MPEnv.platformType!=s.PlatformType.wxMiniProgram&&s.MPEnv.platformType!=s.PlatformType.swanMiniProgram||(null===(i=this.initialAttributes)||void 0===i?void 0:i.isRoot)?"div":"wx-scroll-view"}dispose(){var e;this.didAddScrollListener&&(null===(e=s.MPEnv.platformWindow(this.document))||void 0===e||e.removeEventListener("scroll",this.onWindowScrollEvent),this.htmlElement.removeEventListener("scroll",this.onScrollEvent))}onWindowScrollEvent(){var e;if((null===(e=s.MPEnv.platformWindow(this.document))||void 0===e?void 0:e.mpCurrentScrollView)!==this)return;const t=s.MPEnv.platformWindow(this.document);t&&(t.scrollX===this.lastScrollX&&t.scrollY===this.lastScrollY||(this.lastScrollX=t.scrollX,this.lastScrollY=t.scrollY,this.attributes.onScroll&&this.engine.sendMessage(JSON.stringify({type:"scroll_view",message:{event:"onScroll",target:this.attributes.onScroll,scrollLeft:t.scrollX,scrollTop:t.scrollY}}))))}addWindowScrollListener(){var e;this.didAddScrollListener||(this.didAddScrollListener=!0,null===(e=s.MPEnv.platformWindow(this.document))||void 0===e||e.addEventListener("scroll",this.onWindowScrollEvent.bind(this)))}onScrollEvent(){this.htmlElement.scrollLeft===this.lastScrollX&&this.htmlElement.scrollTop===this.lastScrollY||(this.lastScrollX=this.htmlElement.scrollLeft,this.lastScrollY=this.htmlElement.scrollTop,this.attributes.onScroll&&this.engine.sendMessage(JSON.stringify({type:"scroll_view",message:{event:"onScroll",target:this.attributes.onScroll,scrollLeft:this.htmlElement.scrollLeft,scrollTop:this.htmlElement.scrollTop}})))}addScrollListener(){this.didAddScrollListener||(this.didAddScrollListener=!0,this.htmlElement.addEventListener("scroll",this.onScrollEvent.bind(this)))}didMoveToWindow(){super.didMoveToWindow(),this.enabledRestoration&&s.MPEnv.platformType===s.PlatformType.browser?(this.htmlElement.scrollTo({left:this.lastScrollX,top:this.lastScrollY}),setTimeout((()=>{this.htmlElement.scrollTo({left:this.lastScrollX,top:this.lastScrollY})}),0)):this.enabledRestoration&&s.MPEnv.platformType===s.PlatformType.wxMiniProgram&&(this.htmlElement.setAttribute("scroll-top",this.lastScrollY.toFixed(0)),this.htmlElement.setAttribute("scroll-left",this.lastScrollX.toFixed(0)),setTimeout((()=>{this.htmlElement.setAttribute("scroll-top",this.lastScrollY.toFixed(0)),this.htmlElement.setAttribute("scroll-left",this.lastScrollX.toFixed(0))}),0))}setConstraints(e){super.setConstraints(e),this.viewWidth===e.w&&this.viewHeight===e.h||(this.viewWidth=e.w,this.viewHeight=e.h,this.reloadLayouts())}reloadLayouts(){var e,t,i,s,o,r,l,d;this.layout.prepareLayout();let c=-this.appBarPersistentHeight,h=this.appBarPersistentHeight;for(let u=0;u<this.subviews.length;u++){let p=this.subviews[u],m=this.layout.layoutAttributesForItemAtIndex(u);m&&(p.collectionViewConstraints={top:m.y.toFixed(1)+"px",left:m.x.toFixed(1)+"px"},(0,n.setDOMStyle)(p.htmlElement,{position:"absolute",top:m.y.toFixed(1)+"px",left:m.x.toFixed(1)+"px",width:m.width.toFixed(1)+"px",height:m.height.toFixed(1)+"px"}),p instanceof a.SliverPersistentHeader&&p.pinned?(p.y=m.y-c,p.h=h,c+=p.y+(null!==(t=null===(e=p.constraints)||void 0===e?void 0:e.h)&&void 0!==t?t:0),h+=null!==(s=null===(i=p.constraints)||void 0===i?void 0:i.h)&&void 0!==s?s:0,p.updateLayout()):p instanceof a.SliverPersistentHeader&&p.lazying&&(p.y=m.y-c,p.h=h,c+=p.y+(null!==(r=null===(o=p.constraints)||void 0===o?void 0:o.h)&&void 0!==r?r:0),h+=null!==(d=null===(l=p.constraints)||void 0===l?void 0:l.h)&&void 0!==d?d:0,p.updateLayout()))}const u=this.layout.collectionViewContentSize();(0,n.setDOMStyle)(this.wrapperHtmlElement,{position:"absolute",top:"0px",left:"0px",width:u.width+"px",height:this.bottomBarWithSafeArea?`calc(${u.height+this.bottomBarHeight}px + env(safe-area-inset-bottom))`:u.height+this.bottomBarHeight+"px"})}setAttributes(e){var t,i;if(super.setAttributes(e),(0,n.setDOMStyle)(this.htmlElement,{overflow:e.isRoot?"unset":"scroll"}),this.bottomBarHeight=null!==(t=e.bottomBarHeight)&&void 0!==t?t:0,this.bottomBarWithSafeArea=null!==(i=e.bottomBarWithSafeArea)&&void 0!==i&&i,(e.restorationId&&s.MPEnv.platformType==s.PlatformType.wxMiniProgram||e.restorationId&&s.MPEnv.platformType==s.PlatformType.browser)&&(this.enabledRestoration=!0),this.htmlElement.setAttribute("scroll-x","true"),this.htmlElement.setAttribute("scroll-y","true"),e.isRoot){let e=s.MPEnv.platformWindow(this.document);e&&(e.mpCurrentScrollView=this),this.addWindowScrollListener()}else this.addScrollListener()}addSubview(e){e.superview&&e.removeFromSuperview(),this.subviews.push(e),e.superview=this,this.wrapperHtmlElement.appendChild(e.htmlElement),e.didMoveToWindow()}setPinnedAppBar(e){var t,i;const s=this.factory.create(e.appBarPinned,this.document);if(s){s.collectionViewFixed=!0;let e=null!==(i=null===(t=s.constraints)||void 0===t?void 0:t.h)&&void 0!==i?i:0,o=0,a=1===(null==s?void 0:s.subviews.length)?0:1;null==s||s.subviews.slice().forEach(((t,i)=>{var l,d,c,h,u,p,m,v;i===a-1&&(o+=null!==(d=null===(l=t.constraints)||void 0===l?void 0:l.h)&&void 0!==d?d:0),i===a?((0,n.setDOMStyle)(t.htmlElement,{marginTop:-(e-o)+"px",top:"0px",position:"sticky",zIndex:"9999",backgroundColor:(null!==(h=null===(c=s.attributes)||void 0===c?void 0:c.color)&&void 0!==h?h:null===(u=s.attributes)||void 0===u?void 0:u.backgroundColor)?(0,r.cssColor)(null!==(m=null===(p=s.attributes)||void 0===p?void 0:p.color)&&void 0!==m?m:null===(v=s.attributes)||void 0===v?void 0:v.backgroundColor):"unset"}),this.appBarPersistentHeight=(0,r.cssSizeFromMPElement)(t).height):(0,n.setDOMStyle)(t.htmlElement,{marginTop:-e+"px"}),this.appBarPinnedViews.push(t)})),this.appBarPinnedViews.reverse().forEach((e=>this.addSubviewForPinnedAppBar(e))),(0,n.setDOMStyle)(s.htmlElement,{pointerEvents:"none",display:"none"})}}addSubviewForPinnedAppBar(e){e.superview&&e.removeFromSuperview(),e.superview=this,this.wrapperHtmlElement.firstChild?this.wrapperHtmlElement.insertBefore(e.htmlElement,this.wrapperHtmlElement.firstChild):this.wrapperHtmlElement.appendChild(e.htmlElement),e.didMoveToWindow()}}i.CollectionView=l;i.CollectionViewLayout=class{constructor(e){this.collectionView=e}prepareLayout(){}layoutAttributesForItemAtIndex(e){throw""}collectionViewContentSize(){throw""}}},{"../../env":40,"../component_view":27,"../dom_utils":29,"../utils":37,"./sliver_persistent_header":22}],6:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ColoredBox=void 0;const s=e("../component_view"),o=e("../dom_utils"),n=e("../utils");class r extends s.ComponentView{setAttributes(e){super.setAttributes(e),(0,o.setDOMStyle)(this.htmlElement,{backgroundColor:e.color?(0,n.cssColor)(e.color):"unset"})}}i.ColoredBox=r},{"../component_view":27,"../dom_utils":29,"../utils":37}],7:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.CustomPaint=i.MPDrawable=void 0;const s=e("../../env"),o=e("../component_view"),n=e("../dom_utils"),r=e("../utils");class a{constructor(e){this.engine=e,this.decodedDrawables={}}decodeDrawable(e){return __awaiter(this,void 0,void 0,(function*(){s.MPEnv.platformType!==s.PlatformType.wxMiniProgram&&s.MPEnv.platformType!==s.PlatformType.swanMiniProgram||a.offscreenCanvas||(a.offscreenCanvas=s.MPEnv.platformScope.createOffscreenCanvas());try{if("networkImage"===e.type){const t=yield this.decodeNetworkImage(e.url,e.target);this.engine.sendMessage(JSON.stringify({type:"decode_drawable",message:{event:"onDecode",target:e.target,width:t.width,height:t.height}}))}else{if("memoryImage"!==e.type)throw new Error("Unknown drawable type.");{const t=yield this.decodeMemoryImage(e.data,e.target);this.engine.sendMessage(JSON.stringify({type:"decode_drawable",message:{event:"onDecode",target:e.target,width:t.width,height:t.height}}))}}}catch(t){this.engine.sendMessage(JSON.stringify({type:"decode_drawable",message:{event:"onError",target:e.target,error:null==t?void 0:t.toString()}}))}}))}decodeNetworkImage(e,t){return __awaiter(this,void 0,void 0,(function*(){return new Promise(((i,o)=>{const n=s.MPEnv.platformType===s.PlatformType.wxMiniProgram||s.MPEnv.platformType===s.PlatformType.swanMiniProgram?a.offscreenCanvas.createImage():document.createElement("img");n.onload=()=>{this.decodedDrawables[t]=n,i({width:n.width,height:n.height})},n.onerror=function(){o("")},n.src=e}))}))}decodeMemoryImage(e,t){return __awaiter(this,void 0,void 0,(function*(){return new Promise(((i,o)=>{const n=s.MPEnv.platformType===s.PlatformType.wxMiniProgram||s.MPEnv.platformType===s.PlatformType.swanMiniProgram?a.offscreenCanvas.createImage():document.createElement("img");n.onload=()=>{this.decodedDrawables[t]=n,i({width:n.width,height:n.height})},n.onerror=function(){o("")},n.src=`data:text/plain;base64,${e}`}))}))}}i.MPDrawable=a;class l extends o.ComponentView{constructor(e){super(e),this.document=e,this.canvasWidth=0,this.canvasHeight=0,s.MPEnv.platformType!==s.PlatformType.wxMiniProgram&&s.MPEnv.platformType!==s.PlatformType.swanMiniProgram||this.htmlElement.setAttribute("type","2d")}elementType(){return"canvas"}setConstraints(e){if(!e)return;let t=e.x,i=e.y,s=e.w,o=e.h;"number"==typeof t&&"number"==typeof i&&"number"==typeof s&&"number"==typeof o&&((0,n.setDOMStyle)(this.htmlElement,{left:t+"px",top:i+"px",width:s+"px",height:o+"px"}),this.canvasWidth===s&&this.canvasHeight==o||(this.canvasWidth=s,this.canvasHeight=o,(0,n.setDOMAttribute)(this.htmlElement,"width",this.canvasWidth.toString()),(0,n.setDOMAttribute)(this.htmlElement,"height",this.canvasHeight.toString())))}createContext(){return __awaiter(this,void 0,void 0,(function*(){return s.MPEnv.platformType===s.PlatformType.wxMiniProgram||s.MPEnv.platformType===s.PlatformType.swanMiniProgram?new Promise((e=>{setTimeout((()=>__awaiter(this,void 0,void 0,(function*(){(yield this.htmlElement.$$getNodesRef()).fields({node:!0,size:!0},(t=>{const i=t.node,o=i.getContext("2d"),n=s.MPEnv.platformScope.getSystemInfoSync().pixelRatio;i.width=t.width*n,i.height=t.height*n,o.scale(n,n),e(o)})).exec()}))),16)})):this.htmlElement.getContext("2d")}))}setAttributes(e){const t=Object.create(null,{setAttributes:{get:()=>super.setAttributes}});var i;return __awaiter(this,void 0,void 0,(function*(){t.setAttributes.call(this,e);const s=null!==(i=this.ctx)&&void 0!==i?i:yield this.createContext();s&&(this.ctx||(this.ctx=s),s.save(),e.commands.forEach((e=>{"drawRect"===e.action?this.drawRect(s,e):"drawPath"===e.action?this.drawPath(s,e):"drawDRRect"===e.action?this.drawDRRect(s,e):"clipPath"===e.action?this.drawPath(s,e):"drawColor"===e.action?this.drawColor(s,e):"drawImage"===e.action?this.drawImage(s,e):"drawImageRect"===e.action?this.drawImageRect(s,e):"restore"===e.action?s.restore():"rotate"===e.action?s.rotate(e.radians):"save"===e.action?s.save():"scale"===e.action?s.scale(e.sx,e.sy):"skew"===e.action?s.transform(1,e.sy,e.sx,1,0,0):"transform"===e.action?s.transform(e.a,e.b,e.c,e.d,e.tx,e.ty):"translate"===e.action&&s.translate(e.dx,e.dy)})),s.restore())}))}drawRect(e,t){this.setPaint(e,t.paint),"PaintingStyle.fill"===t.paint.style?e.fillRect(t.x,t.y,t.width,t.height):e.strokeRect(t.x,t.y,t.width,t.height)}drawPath(e,t){this.setPaint(e,t.paint),this.drawRealPath(e,t.path),"clipPath"===t.action?e.clip():"PaintingStyle.fill"===t.paint.style?e.fill():e.stroke()}drawDRRect(e,t){const i=document.createElement("canvas");i.width=e.canvas.width,i.height=e.canvas.height;const s=i.getContext("2d");this.setPaint(s,t.paint),this.drawRealPath(s,t.outer),"PaintingStyle.fill"===t.paint.style?s.fill():s.stroke(),s.save(),s.fillStyle="white",s.globalCompositeOperation="xor",this.drawRealPath(s,t.inner),s.fill(),s.restore(),e.drawImage(i,0,0)}drawRealPath(e,t){e.beginPath(),t.commands.forEach((t=>{"moveTo"===t.action?e.moveTo(t.x,t.y):"lineTo"===t.action?e.lineTo(t.x,t.y):"quadraticBezierTo"===t.action?e.quadraticCurveTo(t.x1,t.y1,t.x2,t.y2):"cubicTo"===t.action?e.bezierCurveTo(t.x1,t.y1,t.x2,t.y2,t.x3,t.y3):"arcTo"===t.action?e.ellipse(t.x,t.y,t.width/2,t.height/2,0,t.startAngle,t.startAngle+t.sweepAngle,t.sweepAngle<0):"arcToPoint"===t.action?e.arcTo(t.arcControlX,t.arcControlY,t.arcEndX,t.arcEndY,t.radiusX):"close"===t.action&&e.closePath()}))}drawColor(e,t){"BlendMode.clear"===t.blendMode?e.clearRect(0,0,e.canvas.width,e.canvas.height):(e.fillStyle=(0,r.cssColor)(t.color),e.fillRect(0,0,e.canvas.width,e.canvas.height))}drawImage(e,t){this.setPaint(e,t.paint);const i=this.engine.drawable.decodedDrawables[t.drawable];i&&e.drawImage(i,t.dx,t.dy)}drawImageRect(e,t){this.setPaint(e,t.paint);const i=this.engine.drawable.decodedDrawables[t.drawable];i&&e.drawImage(i,t.srcX,t.srcY,t.srcW,t.srcH,t.dstX,t.dstY,t.dstW,t.dstH)}setPaint(e,t){var i;t&&(e.lineWidth=t.strokeWidth,e.miterLimit=t.strokeMiterLimit,e.lineCap=t.strokeCap.replace("StrokeCap.",""),e.lineJoin=t.strokeJoin.replace("StrokeJoin.",""),"PaintingStyle.fill"===t.style?(e.fillStyle=(0,r.cssColor)(t.color),e.strokeStyle="transparent"):(e.fillStyle="transparent",e.strokeStyle=(0,r.cssColor)(t.color)),e.globalAlpha=null!==(i=t.alpha)&&void 0!==i?i:1)}}i.CustomPaint=l},{"../../env":40,"../component_view":27,"../dom_utils":29,"../utils":37}],8:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.CustomScrollView=void 0;const s=e("../utils"),o=e("./collection_view"),n=e("./grid_list_layout");class r extends o.CollectionView{constructor(e,t){super(e,t),this.initialAttributes=t,this.listChildren=[],this.layout=new a(this)}setChildren(e){if(!e)return;let t=[],i={},s={};e.forEach(((e,o)=>{var n,r,a,l,d,c,h,u;"sliver_list"===e.name&&e.children?(i[t.length]=e.attributes,this.factory.fetchCachedChildren(e.children).forEach((e=>{t.push(e)})),s[t.length-1]=!0):"sliver_list"===(null===(r=null===(n=e.children)||void 0===n?void 0:n[0])||void 0===r?void 0:r.name)&&(null===(l=null===(a=e.children)||void 0===a?void 0:a[0])||void 0===l?void 0:l.children)?(i[t.length]=e.children[0].attributes,this.factory.fetchCachedChildren(e.children[0].children).forEach(((e,i)=>{t.push(e)})),s[t.length-1]=!0):"sliver_grid"===e.name&&e.children?(i[t.length]=e.attributes,this.factory.fetchCachedChildren(e.children).forEach((e=>{t.push(e)})),s[t.length-1]=!0):"sliver_grid"===(null===(c=null===(d=e.children)||void 0===d?void 0:d[0])||void 0===c?void 0:c.name)&&(null===(u=null===(h=e.children)||void 0===h?void 0:h[0])||void 0===u?void 0:u.children)?(i[t.length]=e.children[0].attributes,this.factory.fetchCachedChildren(e.children[0].children).forEach((e=>{t.push(e)})),s[t.length-1]=!0):t.push(e)})),this.listChildren=t,this.layout.items=t,this.layout.sliverGridAttributes=i,this.layout.sliverGridEndIndex=s,super.setChildren(t),this.reloadLayouts()}setAttributes(e){super.setAttributes(e),this.layout.isHorizontalScroll="Axis.horizontal"===e.scrollDirection,e.appBarPinned?this.setPinnedAppBar(e):this.appBarPinnedViews.length&&(this.appBarPinnedViews.forEach((e=>e.removeFromSuperview())),this.appBarPinnedViews=[],this.appBarPersistentHeight=0)}}i.CustomScrollView=r;class a extends o.CollectionViewLayout{constructor(){super(...arguments),this.isHorizontalScroll=!1,this.items=[],this.maxVLength=0,this.itemLayouts=[],this.sliverGridAttributes={},this.sliverGridEndIndex={}}prepareLayout(){let e=this.collectionView.viewWidth,t=this.collectionView.viewHeight;if(this.isHorizontalScroll&&t<=.01)return;if(!this.isHorizontalScroll&&e<=.01)return;let i,o=[],r=0,a=0;this.items.forEach(((l,d)=>{var c,h,u,p;if(this.sliverGridAttributes[d]){a=0,i=new n.GridListLayout(this.collectionView),i.isHorizontalScroll=this.isHorizontalScroll;let e=[];for(let t=d;t<this.items.length&&(e.push(this.items[t]),!this.sliverGridEndIndex[t]);t++);i.clientWidth=this.collectionView.viewWidth,i.clientHeight=this.collectionView.viewHeight;const t=this.sliverGridAttributes[d].gridDelegate;if(t&&(i.isPlain="SliverWaterfallDelegate"!==t.classname,i.crossAxisCount=t.crossAxisCount,i.mainAxisSpacing=t.mainAxisSpacing,i.crossAxisSpacing=t.crossAxisSpacing),this.sliverGridAttributes[d].padding){const e=(0,s.cssPadding)(this.sliverGridAttributes[d].padding);i.padding.top=parseFloat(null!==(c=e.paddingTop)&&void 0!==c?c:"0.0"),i.padding.left=parseFloat(null!==(h=e.paddingLeft)&&void 0!==h?h:"0.0"),i.padding.bottom=parseFloat(null!==(u=e.paddingBottom)&&void 0!==u?u:"0.0"),i.padding.right=parseFloat(null!==(p=e.paddingRight)&&void 0!==p?p:"0.0")}i.items=e,i.prepareLayout()}if(i){if(a<i.itemLayouts.length){let e=Object.assign({},i.itemLayouts[a]);this.isHorizontalScroll?e.x+=r:e.y+=r,o.push(e)}else o.push({x:0,y:0,width:0,height:0});a++}if(this.sliverGridEndIndex[d]&&i)return this.isHorizontalScroll?r+=i.collectionViewContentSize().width:r+=i.collectionViewContentSize().height,this.maxVLength=r,void(i=void 0);if(i)return;const m=(0,s.cssSizeFromMPElement)(l);let v;this.isHorizontalScroll?(v={x:r,y:0,width:m.width,height:t},r+=m.width):(v={x:0,y:r,width:e,height:m.height},"sliver_persistent_header"===l.name&&l.attributes.lazying||(r+=m.height)),this.maxVLength=r,o.push(v)})),this.itemLayouts=o}collectionViewContentSize(){return this.isHorizontalScroll?{width:this.maxVLength,height:this.collectionView.viewHeight}:{width:this.collectionView.viewWidth,height:this.maxVLength}}layoutAttributesForItemAtIndex(e){return this.itemLayouts[e]}}},{"../utils":37,"./collection_view":5,"./grid_list_layout":13}],9:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.DecoratedBox=void 0;const s=e("../component_view"),o=e("../dom_utils"),n=e("../utils");class r extends s.ComponentView{setAttributes(e){var t,i,s,r,a,l,d,c,h;super.setAttributes(e);let u={};if(e.color?u.backgroundColor=(0,n.cssColor)(e.color):u.backgroundColor="transparent",e.image&&(u.backgroundImage=`url("${(()=>{if(e.image.src)return e.image.src;if(e.image.assetName){if(this.engine.debugger){return(()=>e.image.assetPkg?`http://${this.engine.debugger.serverAddr}/assets/packages/${e.image.assetPkg}/${e.image.assetName}`:`http://${this.engine.debugger.serverAddr}/assets/${e.image.assetName}`)()}return e.image.assetPkg?`assets/packages/${e.image.assetPkg}/${e.assetName}`:`assets/${e.image.assetName}`}})()}")`,"BoxFit.cover"===e.image.fit?u.backgroundSize="cover":u.backgroundSize="contain",u.backgroundRepeat="no-repeat"),(null===(t=e.decoration)||void 0===t?void 0:t.gradient)&&(u.backgroundImage?u.backgroundImage=(0,n.cssGradient)(e.decoration.gradient)+","+u.backgroundImage:u.background=(0,n.cssGradient)(e.decoration.gradient)),null===(s=null===(i=e.decoration)||void 0===i?void 0:i.boxShadow)||void 0===s?void 0:s[0]){const t=null===(a=null===(r=e.decoration)||void 0===r?void 0:r.boxShadow)||void 0===a?void 0:a[0];u.boxShadow=`${null===(l=(0,n.cssOffset)(t.offset))||void 0===l?void 0:l.dx}px ${null===(d=(0,n.cssOffset)(t.offset))||void 0===d?void 0:d.dy}px ${t.blurRadius}px ${t.spreadRadius}px ${(0,n.cssColor)(t.color)}`}if(null===(c=e.decoration)||void 0===c?void 0:c.borderRadius){let t=(0,n.cssBorderRadius)(e.decoration.borderRadius);for(const e in t)u[e]=t[e]}if(null===(h=e.decoration)||void 0===h?void 0:h.border){let t=(0,n.cssBorder)(e.decoration.border);t.boxSizing="border-box";for(const e in t)u[e]=t[e]}(0,o.setDOMStyle)(this.htmlElement,u)}}i.DecoratedBox=r},{"../component_view":27,"../dom_utils":29,"../utils":37}],10:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.EditableText=void 0;const s=e("../../env"),o=e("../component_view"),n=e("../dom_utils"),r=e("../utils");class a extends o.ComponentView{constructor(){super(...arguments),this.contentElementType="",this.didSetListener=!1}setAttributes(e){var t,i;super.setAttributes(e);const o=e.maxLines;if(o>1&&"textarea"!==this.contentElementType?(null===(t=this.contentElement)||void 0===t||t.remove(),this.contentElement=this.document.createElement("textarea"),this.didSetListener=!1,this.contentElementType="textarea",(0,n.setDOMStyle)(this.contentElement,{width:"100%",height:"100%",backgroundColor:"transparent",border:"none",resize:"none"}),this.htmlElement.appendChild(this.contentElement)):o<=1&&"input"!==this.contentElementType&&(null===(i=this.contentElement)||void 0===i||i.remove(),this.contentElement=this.document.createElement("input"),this.didSetListener=!1,this.contentElementType="input",(0,n.setDOMStyle)(this.contentElement,{width:"100%",height:"100%",backgroundColor:"transparent",border:"none"}),this.htmlElement.appendChild(this.contentElement)),this.contentElement){if(e.placeholderStyle){let t="";e.placeholderStyle.color&&(t+=`color: ${(0,r.cssColor)(e.placeholderStyle.color)};`),(0,n.setDOMAttribute)(this.contentElement,"placeholderStyle",t)}if(this.contentElement.onkeyup=e=>{"Enter"!==e.key&&13!==e.keyCode||this._onSubmitted(e.target,e.target.value)},this.didSetListener||(this.didSetListener=!0,this.contentElement.addEventListener("submit",(e=>{var t,i;this._onSubmitted(e.target,null!==(i=null===(t=e.detail)||void 0===t?void 0:t.value)&&void 0!==i?i:e.target.value)})),this.contentElement.addEventListener("input",(e=>{var t,i;this._onChanged(e.target,null!==(i=null===(t=e.detail)||void 0===t?void 0:t.value)&&void 0!==i?i:e.target.value)}))),this.contentElement.onchange=e=>{var t,i;this._onChanged(e.target,null!==(i=null===(t=e.detail)||void 0===t?void 0:t.value)&&void 0!==i?i:e.target.value)},e.style){let t=(0,r.cssTextStyle)(e.style);delete t.userSelect,delete t.WebkitUserSelect,(0,n.setDOMStyle)(this.contentElement,Object.assign(Object.assign({},t),{textAlign:(0,r.cssTextAlign)(e.textAlign),boxSizing:"border-box"}))}(0,n.setDOMAttribute)(this.contentElement,"type",e.obscureText?"password":this._keyboardType(e.keyboardType)),(0,n.setDOMAttribute)(this.contentElement,"pattern",this._keyboardPattern(e.keyboardType)),"string"==typeof e.value&&(s.MPEnv.platformType===s.PlatformType.wxMiniProgram||s.MPEnv.platformType===s.PlatformType.swanMiniProgram?(0,n.setDOMAttribute)(this.contentElement,"value",e.value):this.contentElement.value=e.value),e.autofocus&&(0,n.setDOMAttribute)(this.contentElement,"autoFocus",e.autofocus),e.autoCorrect&&(0,n.setDOMAttribute)(this.contentElement,"autoCorrect",e.autoCorrect),e.placeholder&&(0,n.setDOMAttribute)(this.contentElement,"placeholder",e.placeholder),s.MPEnv.platformType===s.PlatformType.wxMiniProgram||s.MPEnv.platformType===s.PlatformType.swanMiniProgram?(0,n.setDOMAttribute)(this.contentElement,"disabled",e.readOnly?"true":void 0):(0,n.setDOMAttribute)(this.contentElement,"readOnly",e.readOnly?"true":void 0)}}setChildren(){}_keyboardType(e){return(null==e?void 0:e.indexOf("TextInputType.number"))>0?"number":"text"}_keyboardPattern(e){if((null==e?void 0:e.indexOf("TextInputType.number"))>0){const t=e.indexOf("signed: true")>0,i=e.indexOf("decimal: true")>0;if(t&&i)return"[0-9+-.]*";if(t&&!i)return"[0-9+-]*";if(!t&&!i)return"[0-9]*"}return""}_onSubmitted(e,t){this.attributes.onSubmitted&&(this.engine.sendMessage(JSON.stringify({type:"editable_text",message:{event:"onSubmitted",target:this.attributes.onSubmitted,data:t}})),e.blur())}_onChanged(e,t){this.attributes.onChanged&&this.engine.sendMessage(JSON.stringify({type:"editable_text",message:{event:"onChanged",target:this.attributes.onChanged,data:t}}))}}i.EditableText=a},{"../../env":40,"../component_view":27,"../dom_utils":29,"../utils":37}],11:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ForegroundDecoratedBox=void 0;const s=e("../component_view"),o=e("../dom_utils"),n=e("../utils");class r extends s.ComponentView{constructor(){super(...arguments),this.decorateElement=this.document.createElement("div")}setChildren(e){super.setChildren(e),this.decorateElement.remove(),this.htmlElement.appendChild(this.decorateElement)}setAttributes(e){var t,i,s,r,a,l,d,c,h;super.setAttributes(e);let u={position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%"};if(e.color?u.backgroundColor=(0,n.cssColor)(e.color):u.backgroundColor="transparent",e.image&&(u.backgroundImage=`url("${(()=>{if(e.image.src)return e.image.src;if(e.image.assetName){if(this.engine.debugger){return(()=>e.image.assetPkg?`http://${this.engine.debugger.serverAddr}/assets/packages/${e.image.assetPkg}/${e.image.assetName}`:`http://${this.engine.debugger.serverAddr}/assets/${e.image.assetName}`)()}return e.image.assetPkg?`assets/packages/${e.image.assetPkg}/${e.assetName}`:`assets/${e.image.assetName}`}})()}")`,"BoxFit.cover"===e.image.fit?u.backgroundSize="cover":u.backgroundSize="contain",u.backgroundRepeat="no-repeat"),(null===(t=e.decoration)||void 0===t?void 0:t.gradient)&&(u.backgroundImage?u.backgroundImage=(0,n.cssGradient)(e.decoration.gradient)+","+u.backgroundImage:u.background=(0,n.cssGradient)(e.decoration.gradient)),null===(s=null===(i=e.decoration)||void 0===i?void 0:i.boxShadow)||void 0===s?void 0:s[0]){const t=null===(a=null===(r=e.decoration)||void 0===r?void 0:r.boxShadow)||void 0===a?void 0:a[0];u.boxShadow=`${null===(l=(0,n.cssOffset)(t.offset))||void 0===l?void 0:l.dx}px ${null===(d=(0,n.cssOffset)(t.offset))||void 0===d?void 0:d.dy}px ${t.blurRadius}px ${t.spreadRadius}px ${(0,n.cssColor)(t.color)}`}if(null===(c=e.decoration)||void 0===c?void 0:c.borderRadius){let t=(0,n.cssBorderRadius)(e.decoration.borderRadius);for(const e in t)u[e]=t[e]}if(null===(h=e.decoration)||void 0===h?void 0:h.border){let t=(0,n.cssBorder)(e.decoration.border);t.boxSizing="border-box";for(const e in t)u[e]=t[e]}(0,o.setDOMStyle)(this.decorateElement,u)}}i.ForegroundDecoratedBox=r},{"../component_view":27,"../dom_utils":29,"../utils":37}],12:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.GestureDetector=void 0;const s=e("../../env"),o=e("../component_view");class n extends o.ComponentView{constructor(e){super(e),this.document=e,this.classname="GestureDetector",this.didSetOnClicked=!1,this.didSetOnLongPressOrPan=!1,this.longPressing=!1,this.htmlElement.isGestureDetector=!0,this.setupCursor()}setupCursor(){s.MPEnv.platformPC()&&(this.htmlElement.style.cursor="pointer")}elementType(){return s.MPEnv.platformType===s.PlatformType.wxMiniProgram?"wx-catch":"div"}setChildren(e){super.setChildren(e),this.subviews.forEach((e=>{var t,i,s,o;e.gestureViewConstraints={x:null!==(i=null===(t=this.constraints)||void 0===t?void 0:t.x)&&void 0!==i?i:0,y:null!==(o=null===(s=this.constraints)||void 0===s?void 0:s.y)&&void 0!==o?o:0},e.updateLayout()}))}setAttributes(e){super.setAttributes(e),e.onTap&&(this.didSetOnClicked||(this.didSetOnClicked=!0,this.htmlElement.addEventListener("click",(t=>{this.engine.sendMessage(JSON.stringify({type:"gesture_detector",message:{event:"onTap",target:e.onTap}})),t.stopPropagation()})))),(e.onLongPress||e.onLongPressStart||e.onLongPressMoveUpdate||e.onLongPressEnd||e.onPanStart||e.onPanUpdate||e.onPanEnd)&&(this.didSetOnLongPressOrPan||(this.didSetOnLongPressOrPan=!0,this.setupLongPressOrPanCatcher()))}findGestureDetectorElement(e){for(let t=0;t<e.length;t++){const i=e[t];if(i.isGestureDetector)return i}}setupLongPressOrPanCatcher(){this.htmlElement.addEventListener("touchstart",(e=>{this._onTouchStart(e)}),!0),this.htmlElement.addEventListener("touchmove",(e=>{this._onTouchMove(e)}),!0),this.htmlElement.addEventListener("touchend",(e=>{this._onTouchEnd(e)}),!0),this.htmlElement.addEventListener("touchcancel",(()=>{this.longPressTimer&&(clearTimeout(this.longPressTimer),this.longPressTimer=void 0),this.longPressing=!1}),!0)}_onTouchStart(e){let t=this.attributes.onPanStart||this.attributes.onPanUpdate||this.attributes.onPanEnd;(this.attributes.onLongPress||this.attributes.onLongPressStart||this.attributes.onLongPressEnd||this.attributes.onLongPressMoveUpdate||t)&&(this.touchStartPosition={x:e.touches[0].clientX,y:e.touches[0].clientY},this.longPressTimer=setTimeout((()=>{this.longPressTimer&&(this.longPressing=!0,this.attributes.onLongPress&&this.engine.sendMessage(JSON.stringify({type:"gesture_detector",message:{event:"onLongPress",target:this.attributes.onLongPress}})),(this.attributes.onLongPressStart||this.attributes.onPanStart)&&this.engine.sendMessage(JSON.stringify({type:"gesture_detector",message:{event:this.attributes.onPanStart?"onPanStart":"onLongPressStart",target:this.attributes.onPanStart?this.attributes.onPanStart:this.attributes.onLongPressStart,globalX:e.touches[0].clientX,globalY:e.touches[0].clientY}})),this.longPressTimer=void 0)}),t?0:300))}_onTouchMove(e){if(this.longPressing&&(this.attributes.onLongPressMoveUpdate||this.attributes.onPanUpdate))this.engine.sendMessage(JSON.stringify({type:"gesture_detector",message:{event:this.attributes.onPanUpdate?"onPanUpdate":"onLongPressMoveUpdate",target:this.attributes.onPanUpdate?this.attributes.onPanUpdate:this.attributes.onLongPressMoveUpdate,globalX:e.touches[0].clientX,globalY:e.touches[0].clientY}}));else if(this.longPressTimer&&this.touchStartPosition){const t={x:e.touches[0].clientX,y:e.touches[0].clientY},i=Math.abs(t.x-this.touchStartPosition.x),s=Math.abs(t.y-this.touchStartPosition.y);(i>8||s>8)&&(clearTimeout(this.longPressTimer),this.longPressTimer=void 0)}}_onTouchEnd(e){this.longPressing&&(this.attributes.onLongPressEnd||this.attributes.onPanEnd)?this.engine.sendMessage(JSON.stringify({type:"gesture_detector",message:{event:this.attributes.onPanEnd?"onPanEnd":"onLongPressEnd",target:this.attributes.onPanEnd?this.attributes.onPanEnd:this.attributes.onLongPressEnd}})):this.longPressTimer&&(clearTimeout(this.longPressTimer),this.longPressTimer=void 0),this.longPressing=!1}}i.GestureDetector=n},{"../../env":40,"../component_view":27}],13:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.GridListLayout=void 0;const s=e("../utils"),o=e("./collection_view");class n extends o.CollectionViewLayout{constructor(){super(...arguments),this.isPlain=!0,this.isHorizontalScroll=!1,this.padding={top:0,left:0,bottom:0,right:0},this.clientWidth=0,this.clientHeight=0,this.crossAxisCount=0,this.crossAxisSpacing=0,this.mainAxisSpacing=0,this.items=[],this.maxVLength=0,this.itemLayouts=[]}prepareLayout(){this.isPlain?this.preparePlainLayout():this.prepareWaterfallLayout()}preparePlainLayout(){let e=(this.clientWidth>0?this.clientWidth:this.collectionView.viewWidth)-this.padding.right,t=(this.clientHeight>0?this.clientHeight:this.collectionView.viewHeight)-this.padding.bottom,i=[],o=this.padding.left,n=this.padding.top,r=0;this.items.forEach(((a,l)=>{const d=(0,s.cssSizeFromMPElement)(a),c=d.width,h=d.height;if(this.isHorizontalScroll){const e={x:o,y:n,width:c,height:h};n+=h+this.crossAxisSpacing,r=Math.max(o+c,r),n+h-t>.1&&(n=this.padding.top,l+1<this.items.length&&(o+=c+this.mainAxisSpacing)),i.push(e)}else{const t={x:o,y:n,width:c,height:h};o+=c+this.crossAxisSpacing,r=Math.max(n+h,r),o+c-e>.1&&(o=this.padding.left,l+1<this.items.length&&(n+=h+this.mainAxisSpacing)),i.push(t)}})),this.isHorizontalScroll?r+=this.padding.right:r+=this.padding.bottom,this.itemLayouts=i,this.maxVLength=r}prepareWaterfallLayout(){if(this.crossAxisCount<=0)return void(this.itemLayouts=[]);let e=0,t={},i=[],o=0;this.items.forEach(((n,r)=>{let a=(0,s.cssSizeFromMPElement)(n),l=a.width,d=a.height,c=this.isHorizontalScroll?this.padding.left:this.padding.top;{let i=e,s=i+1>=this.crossAxisCount?0:i+1;if(t[i]&&t[s]){let o=t[i],n=t[s];e=this.isHorizontalScroll?n.x+n.width<o.x+o.width?s:i:n.y+n.height<o.y+o.height?s:i}else e=i}if(t[e]){let i=t[e];this.isHorizontalScroll?(c=i.x+i.width,r>=this.crossAxisCount&&(c+=this.mainAxisSpacing)):(c=i.y+i.height,r>=this.crossAxisCount&&(c+=this.mainAxisSpacing))}else c=this.isHorizontalScroll?this.padding.left:this.padding.top;if(this.isHorizontalScroll){let s={x:c,y:this.padding.top+d*e+e*this.crossAxisSpacing,width:l,height:d};t[e]=s,e=(e+1)%this.crossAxisCount,o=Math.max(c+l,o),i.push(s)}else{let s={x:this.padding.left+l*e+e*this.crossAxisSpacing,y:c,width:l,height:d};t[e]=s,e=(e+1)%this.crossAxisCount,o=Math.max(c+d,o),i.push(s)}})),this.isHorizontalScroll?o+=this.padding.right:o+=this.padding.bottom,this.itemLayouts=i,this.maxVLength=o}collectionViewContentSize(){return this.isHorizontalScroll?{width:this.maxVLength,height:this.collectionView.viewHeight-this.padding.top-this.padding.bottom}:{width:this.collectionView.viewWidth-this.padding.left-this.padding.right,height:this.maxVLength}}layoutAttributesForItemAtIndex(e){return this.itemLayouts[e]}}i.GridListLayout=n},{"../utils":37,"./collection_view":5}],14:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.GridView=void 0;const s=e("../utils"),o=e("./collection_view"),n=e("./grid_list_layout");class r extends o.CollectionView{constructor(e,t){super(e,t),this.initialAttributes=t,this.listChildren=[],this.layout=new n.GridListLayout(this)}setChildren(e){if(super.setChildren(e),!e)return;let t=[];this.factory.fetchCachedChildren(e).forEach((e=>{t.push(e),this.factory.create(e,this.document)})),this.layout.items=t,this.listChildren=t,this.reloadLayouts()}setAttributes(e){var t,i,o,n;super.setAttributes(e),this.layout.isHorizontalScroll="Axis.horizontal"===e.scrollDirection;const r=e.gridDelegate;if(r&&(this.layout.isPlain="SliverWaterfallDelegate"!==r.classname,this.layout.crossAxisCount=r.crossAxisCount,this.layout.mainAxisSpacing=r.mainAxisSpacing,this.layout.crossAxisSpacing=r.crossAxisSpacing),e.padding){const e=(0,s.cssPadding)(this.attributes.padding);this.layout.padding.top=parseFloat(null!==(t=e.paddingTop)&&void 0!==t?t:"0.0"),this.layout.padding.left=parseFloat(null!==(i=e.paddingLeft)&&void 0!==i?i:"0.0"),this.layout.padding.bottom=parseFloat(null!==(o=e.paddingBottom)&&void 0!==o?o:"0.0"),this.layout.padding.right=parseFloat(null!==(n=e.paddingRight)&&void 0!==n?n:"0.0")}e.appBarPinned?this.setPinnedAppBar(e):this.appBarPinnedViews.length&&(this.appBarPinnedViews.forEach((e=>e.removeFromSuperview())),this.appBarPinnedViews=[],this.appBarPersistentHeight=0),this.reloadLayouts()}}i.GridView=r},{"../utils":37,"./collection_view":5,"./grid_list_layout":13}],15:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.IgnorePointer=void 0;const s=e("../component_view"),o=e("../dom_utils");class n extends s.ComponentView{setAttributes(e){super.setAttributes(e),(0,o.setDOMStyle)(this.htmlElement,{pointerEvents:"none"})}}i.IgnorePointer=n},{"../component_view":27,"../dom_utils":29}],16:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Image=void 0;const s=e("../../env"),o=e("../component_view"),n=e("../dom_utils");class r extends o.ComponentView{elementType(){return"img"}updateLayout(){var e,t,i,s,o,r;(null===(e=this.attributes)||void 0===e?void 0:e.width)&&(null===(t=this.attributes)||void 0===t?void 0:t.height)||(null===(i=this.constraints)||void 0===i?void 0:i.w)&&(null===(s=this.constraints)||void 0===s?void 0:s.h)?super.updateLayout():(0,n.setDOMStyle)(this.htmlElement,{position:null!==(r=null===(o=this.additionalConstraints)||void 0===o?void 0:o.position)&&void 0!==r?r:"absolute",left:"0px",top:"0px",width:"100%",height:"100%"})}setAttributes(e){if(super.setAttributes(e),(0,n.setDOMStyle)(this.htmlElement,{objectFit:(()=>{if(!e.fit)return"cover";switch(e.fit){case"BoxFit.fill":return"fill";default:return"contain";case"BoxFit.cover":return"cover";case"BoxFit.fitWidth":case"BoxFit.fitHeight":return"scale-down";case"BoxFit.none":return"none"}})()}),!e.fit||s.MPEnv.platformType!==s.PlatformType.wxMiniProgram&&s.MPEnv.platformType!==s.PlatformType.swanMiniProgram||(0,n.setDOMAttribute)(this.htmlElement,"mode",(()=>{if(!e.fit)return"cover";switch(e.fit){case"BoxFit.fill":return"scaleToFill";default:return"aspectFit";case"BoxFit.cover":return"aspectFill";case"BoxFit.fitWidth":return"widthFix";case"BoxFit.fitHeight":return"heightFix"}})()),e.src)e.lazyLoad?s.MPEnv.platformType===s.PlatformType.browser?(this.htmlElement.classList.add("lazyload"),(0,n.setDOMAttribute)(this.htmlElement,"data-src",e.src),lazyload([this.htmlElement])):s.MPEnv.platformType===s.PlatformType.wxMiniProgram||s.MPEnv.platformType===s.PlatformType.swanMiniProgram?((0,n.setDOMAttribute)(this.htmlElement,"lazyLoad","true"),(0,n.setDOMAttribute)(this.htmlElement,"src",e.src)):(0,n.setDOMAttribute)(this.htmlElement,"src",e.src):(0,n.setDOMAttribute)(this.htmlElement,"src",e.src);else if(e.assetName)if(this.engine.debugger){const t=(()=>e.assetPkg?`http://${this.engine.debugger.serverAddr}/assets/packages/${e.assetPkg}/${e.assetName}`:`http://${this.engine.debugger.serverAddr}/assets/${e.assetName}`)();(0,n.setDOMAttribute)(this.htmlElement,"src",t)}else{let t=e.assetPkg?`assets/packages/${e.assetPkg}/${e.assetName}`:`assets/${e.assetName}`;s.MPEnv.platformType!==s.PlatformType.wxMiniProgram&&s.MPEnv.platformType!==s.PlatformType.swanMiniProgram||(t="/"+t),(0,n.setDOMAttribute)(this.htmlElement,"src",t)}this.updateLayout()}}i.Image=r},{"../../env":40,"../component_view":27,"../dom_utils":29}],17:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ListView=void 0;const s=e("../utils"),o=e("./collection_view"),n=e("./grid_list_layout");class r extends o.CollectionView{constructor(e,t){super(e,t),this.initialAttributes=t,this.listChildren=[],this.layout=new n.GridListLayout(this)}setChildren(e){if(super.setChildren(e),!e)return;let t=[];this.factory.fetchCachedChildren(e).forEach((e=>{t.push(e),this.factory.create(e,this.document)})),this.layout.items=t,this.listChildren=t,this.reloadLayouts()}setAttributes(e){var t,i,o,n;if(super.setAttributes(e),this.layout.isHorizontalScroll="Axis.horizontal"===e.scrollDirection,e.padding){const e=(0,s.cssPadding)(this.attributes.padding);this.layout.padding.top=parseFloat(null!==(t=e.paddingTop)&&void 0!==t?t:"0.0"),this.layout.padding.left=parseFloat(null!==(i=e.paddingLeft)&&void 0!==i?i:"0.0"),this.layout.padding.bottom=parseFloat(null!==(o=e.paddingBottom)&&void 0!==o?o:"0.0"),this.layout.padding.right=parseFloat(null!==(n=e.paddingRight)&&void 0!==n?n:"0.0")}e.appBarPinned?this.setPinnedAppBar(e):this.appBarPinnedViews.length&&(this.appBarPinnedViews.forEach((e=>e.removeFromSuperview())),this.appBarPinnedViews=[],this.appBarPersistentHeight=0),this.reloadLayouts()}}i.ListView=r},{"../utils":37,"./collection_view":5,"./grid_list_layout":13}],18:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Offstage=void 0;const s=e("../component_view"),o=e("../dom_utils");class n extends s.ComponentView{setAttributes(e){super.setAttributes(e),(0,o.setDOMStyle)(this.htmlElement,{display:e.offstage?"none":"unset"})}}i.Offstage=n},{"../component_view":27,"../dom_utils":29}],19:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.OpacityAncestor=i.Opacity=void 0;const s=e("../component_view"),o=e("../dom_utils");class n extends s.ComponentView{setAttributes(e){super.setAttributes(e),(0,o.setDOMStyle)(this.htmlElement,{opacity:e.opacity.toString()})}}i.Opacity=n;class r extends s.AncestorView{setAttributes(e){super.setAttributes(e),this.target.ancestorStyle.opacity||(this.target.ancestorStyle.opacity=1),this.target.ancestorStyle.opacity*=e.opacity}}i.OpacityAncestor=r},{"../component_view":27,"../dom_utils":29}],20:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Overlay=void 0;const s=e("../component_view"),o=e("../dom_utils");class n extends s.ComponentView{constructor(e,t){super(e,t),this.initialAttributes=t,this.didSetListener=!1,this.additionalConstraints={position:"fixed"},(0,o.setDOMStyle)(this.htmlElement,{position:"fixed",zIndex:"10000",left:"0px",top:"0px",right:"0px",bottom:"0px",touchAction:"none"})}elementType(){return"div"}setAttributes(e){super.setAttributes(e),e.onBackgroundTap&&!this.didSetListener&&(this.didSetListener=!0,this.htmlElement.addEventListener("click",(t=>{e.onBackgroundTap&&(!0===e.barrierDismissible&&this.htmlElement.remove(),this.engine.sendMessage(JSON.stringify({type:"overlay",message:{event:"onBackgroundTap",target:e.onBackgroundTap}})),t.stopPropagation())})))}}i.Overlay=n},{"../component_view":27,"../dom_utils":29}],21:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.WidgetSpan=i.TextSpan=i.RichText=void 0;const s=e("../../env"),o=e("../component_view"),n=e("../dom_utils"),r=e("../utils");class a extends o.ComponentView{constructor(){super(...arguments),this.measuring=!1,this.didSetOnClicked=!1}elementType(){return"div"}setConstraints(e){this.measuring||e&&(this.constraints=e,this.updateLayout(),(0,n.setDOMStyle)(this.htmlElement,{position:"absolute",opacity:"1"}))}setAttributes(e){var t;super.setAttributes(e),s.MPEnv.platformType!==s.PlatformType.wxMiniProgram&&s.MPEnv.platformType!==s.PlatformType.swanMiniProgram||this.htmlElement.classList.add("mp_text");const i=e.maxWidth;this.maxWidth="string"==typeof i?parseFloat(i):void 0;const o=e.maxHeight;this.maxHeight="string"==typeof o?parseFloat(o):void 0,(0,n.setDOMStyle)(this.htmlElement,{overflow:"hidden",textOverflow:"ellipsis",textAlign:(0,r.cssTextAlign)(e.textAlign),display:"-webkit-box",fontSize:"11px",fontFamily:"sans-serif",lineHeight:null===(t=e.height)||void 0===t?void 0:t.toString(),overflowWrap:"anywhere",wordBreak:"break-all",wordWrap:"break-word",whiteSpace:"pre-line",webkitBoxOrient:"vertical",webkitLineClamp:e.maxLines?e.maxLines.toString():"99999"}),this.measureId=e.measureId}setSingleTextSpan(e){return __awaiter(this,void 0,void 0,(function*(){let t={};if(e[0].attributes.style){let i=(0,r.cssTextStyle)(e[0].attributes.style);for(const e in i)t[e]=i[e]}e[0].attributes.text&&(this.htmlElement.innerText=e[0].attributes.text,s.MPEnv.platformType!==s.PlatformType.wxMiniProgram&&s.MPEnv.platformType!==s.PlatformType.swanMiniProgram||(0,n.setDOMAttribute)(this.htmlElement,"innerText",e[0].attributes.text)),e[0].attributes.onTap_el&&e[0].attributes.onTap_span&&!this.didSetOnClicked&&(this.didSetOnClicked=!0,this.htmlElement.addEventListener("click",(t=>{this.onClick(e[0].attributes.onTap_el,e[0].attributes.onTap_span),t&&t.stopPropagation()}))),(0,n.setDOMStyle)(this.htmlElement,t)}))}setChildren(e){const t=Object.create(null,{setChildren:{get:()=>super.setChildren}});var i;return __awaiter(this,void 0,void 0,(function*(){e&&1===e.length&&"text_span"===e[0].name&&(null===(i=e[0].attributes)||void 0===i?void 0:i.text)?this.setSingleTextSpan(e):t.setChildren.call(this,e)}))}onClick(e,t){this.engine.sendMessage(JSON.stringify({type:"rich_text",message:{event:"onTap",target:e,subTarget:t}}))}}i.RichText=a;class l extends o.ComponentView{constructor(){super(...arguments),this.didSetOnClicked=!1}elementType(){return"div"}setChildren(e){e instanceof Array&&e.length>0&&super.setChildren(e)}setAttributes(e){super.setAttributes(e);let t={position:"unset",display:"inline"};if(e.style){let i=(0,r.cssTextStyle)(e.style);for(const e in i)t[e]=i[e]}e.text&&(this.htmlElement.innerText=e.text,s.MPEnv.platformType!==s.PlatformType.wxMiniProgram&&s.MPEnv.platformType!==s.PlatformType.swanMiniProgram||(0,n.setDOMAttribute)(this.htmlElement,"innerText",e.text)),e.onTap_el&&e.onTap_span&&!this.didSetOnClicked&&(this.didSetOnClicked=!0,this.htmlElement.addEventListener("click",(e=>{this.onClick(),e&&e.stopPropagation()}))),(0,n.setDOMStyle)(this.htmlElement,t)}onClick(){this.attributes.onTap_el&&this.attributes.onTap_span&&this.engine.sendMessage(JSON.stringify({type:"rich_text",message:{event:"onTap",target:this.attributes.onTap_el,subTarget:this.attributes.onTap_span}}))}}i.TextSpan=l;class d extends o.ComponentView{elementType(){return"div"}setChildren(e){super.setChildren(e),this.subviews[0]&&(this.subviews[0].additionalConstraints={position:"relative"},(0,n.setDOMStyle)(this.subviews[0].htmlElement,{position:"relative",display:"inline-flex"}))}setAttributes(e){super.setAttributes(e),(0,n.setDOMStyle)(this.htmlElement,{display:"contents"})}}i.WidgetSpan=d},{"../../env":40,"../component_view":27,"../dom_utils":29,"../utils":37}],22:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.SliverPersistentHeader=void 0;const s=e("../../env"),o=e("../component_view"),n=e("../dom_utils");class r extends o.ComponentView{constructor(){super(...arguments),this.pinned=!0,this.lazying=!1,this.observingScroller=!1,this.lazyOffset=0,this.y=0,this.h=0}setAttributes(e){this.attributes=e,this.pinned=e.pinned,this.lazying=e.lazying,this.lazyOffset=e.lazyOffset,this.updateLayout(),this.lazying&&!this.observingScroller&&(this.observeScroller(),this.updateLazyState(0))}observeScroller(){if(this.lazying&&!this.observingScroller)if(this.observingScroller=!0,s.MPEnv.platformType===s.PlatformType.browser)setTimeout((()=>{var e;this.superview&&(e=t=>{this.htmlElement.isConnected||(this.observingScroller=!1,window.removeEventListener("scroll",e)),this.updateLazyState(window.scrollY)},window.addEventListener("scroll",e))}),32);else if(s.MPEnv.platformType===s.PlatformType.wxMiniProgram||s.MPEnv.platformType===s.PlatformType.swanMiniProgram){var e;e=e=>{this.updateLazyState(this.document.window.scrollY)},this.document.window.addEventListener("scroll",e)}}updateLazyState(e){this.lazying&&(0,n.setDOMStyle)(this.htmlElement,{opacity:e>this.lazyOffset?"1.0":"0.0"})}updateLayout(){var e,t,i,s,o,r;if(!this.constraints)return;let a=this.constraints.x,l=this.y,d=this.constraints.w,c=this.constraints.h;this.ancestors.forEach((e=>{e.constraints&&(a+=e.constraints.x,l+=e.constraints.y)})),(0,n.setDOMStyle)(this.htmlElement,{position:"sticky",left:null!==(t=null===(e=this.additionalConstraints)||void 0===e?void 0:e.left)&&void 0!==t?t:a+"px",top:this.pinned?this.h+"px":"unset",marginTop:this.pinned?l+"px":"unset",width:null!==(s=null===(i=this.additionalConstraints)||void 0===i?void 0:i.width)&&void 0!==s?s:d+"px",height:null!==(r=null===(o=this.additionalConstraints)||void 0===o?void 0:o.height)&&void 0!==r?r:c+"px",zIndex:"99"})}}i.SliverPersistentHeader=r},{"../../env":40,"../component_view":27,"../dom_utils":29}],23:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Transform=void 0;const s=e("../component_view"),o=e("../dom_utils");class n extends s.ComponentView{setAttributes(e){super.setAttributes(e),(0,o.setDOMStyle)(this.htmlElement,{transform:e.transform})}}i.Transform=n},{"../component_view":27,"../dom_utils":29}],24:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Visibility=void 0;const s=e("../component_view"),o=e("../dom_utils");class n extends s.ComponentView{setAttributes(e){super.setAttributes(e),(0,o.setDOMStyle)(this.htmlElement,{display:e.visible?"contents":"none"})}}i.Visibility=n},{"../component_view":27,"../dom_utils":29}],25:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.WebDialogs=void 0;const s=e("../../env");i.WebDialogs=class{static receivedWebDialogsMessage(e,t){s.MPEnv.platformType===s.PlatformType.wxMiniProgram||s.MPEnv.platformType===s.PlatformType.swanMiniProgram?this.wxMiniProgramReceivedWebDialogsMessage(e,t):this.browserMiniProgramReceivedWebDialogsMessage(e,t)}static wxMiniProgramReceivedWebDialogsMessage(e,t){var i,o,n;if("alert"===t.params.dialogType)s.MPEnv.platformScope.showModal({content:t.params.message,showCancel:!1,confirmText:"确定",success:()=>{e.sendMessage(JSON.stringify({type:"action",message:{event:"callback",id:t.id}}))}});else if("confirm"===t.params.dialogType)s.MPEnv.platformScope.showModal({content:t.params.message,cancelText:"取消",confirmText:"确认",success:i=>{e.sendMessage(JSON.stringify({type:"action",message:{event:"callback",id:t.id,data:1==i.confirm}}))}});else if("prompt"===t.params.dialogType)s.MPEnv.platformType===s.PlatformType.swanMiniProgram?s.MPEnv.platformScope.openReplyEditor({contentPlaceholder:t.params.message,content:null!==(i=t.params.defaultValue)&&void 0!==i?i:"",sendText:"确认",success:i=>{swan.closeReplyEditor(),"reply"===i.status?e.sendMessage(JSON.stringify({type:"action",message:{event:"callback",id:t.id,data:i.content}})):e.sendMessage(JSON.stringify({type:"action",message:{event:"callback",id:t.id,data:null}}))},fail:()=>{e.sendMessage(JSON.stringify({type:"action",message:{event:"callback",id:t.id,data:null}}))}}):s.MPEnv.platformScope.showModal({title:t.params.message,content:null!==(o=t.params.defaultValue)&&void 0!==o?o:"",editable:!0,cancelText:"取消",confirmText:"确认",success:i=>{e.sendMessage(JSON.stringify({type:"action",message:{event:"callback",id:t.id,data:i.content}}))},fail:()=>{e.sendMessage(JSON.stringify({type:"action",message:{event:"callback",id:t.id,data:null}}))}});else if("actionSheet"===t.params.dialogType)s.MPEnv.platformScope.showActionSheet({itemList:t.params.items,success:i=>{e.sendMessage(JSON.stringify({type:"action",message:{event:"callback",id:t.id,data:i.tapIndex}}))},fail:()=>{e.sendMessage(JSON.stringify({type:"action",message:{event:"callback",id:t.id,data:null}}))}});else if("showToast"===t.params.dialogType){let e={};t.params.title&&(e.title=t.params.title),t.params.icon&&(e.icon=null===(n=t.params.icon)||void 0===n?void 0:n.replace("ToastIcon.","")),t.params.duration&&(e.duration=t.params.duration),t.params.mask&&(e.mask=t.params.mask),s.MPEnv.platformScope.showToast(e)}else"hideToast"===t.params.dialogType?s.MPEnv.platformScope.hideToast():"picker"===t.params.dialogType||t.params.dialogType}static browserMiniProgramReceivedWebDialogsMessage(e,t){}}},{"../../env":40}],26:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ComponentFactory=void 0;const s=e("./basic/absorb_pointer"),o=e("./basic/clip_oval"),n=e("./basic/clip_r_rect"),r=e("./basic/colored_box"),a=e("./basic/decorated_box"),l=e("./basic/gesture_detector"),d=e("./basic/ignore_pointer"),c=e("./basic/offstage"),h=e("./basic/opacity"),u=e("./basic/transform"),p=e("./basic/image"),m=e("./component_view"),v=e("./mpkit/scaffold"),g=e("./basic/rich_text"),f=e("./basic/list_view"),y=e("./basic/grid_view"),w=e("./basic/custom_scroll_view"),b=e("./basic/custom_paint"),P=e("./mpkit/icon"),M=e("./mpkit/video_view"),S=e("./mpkit/web_view"),x=e("./mpkit/page_view"),_=e("./mpkit/miniprogram_view"),E=e("./basic/overlay"),C=e("./basic/visibility"),T=e("./basic/sliver_persistent_header"),O=e("./basic/editable_text"),R=e("./mpkit/platform_view"),A=e("./basic/foreground_decorated_box"),k=e("../env");class V{constructor(e){this.engine=e,this.cachedView={},this.cachedAncestor={},this.cachedElement={},this.textMeasureResults=[],this.markedNeedsFlushTextMeasureResult=!1}create(e,t){var i;if(!e)return;const s=e["^"],o=e.name,n=e.hashCode;if(1==s&&"number"==typeof n)return this.cachedView[n];if(!o||!n)return;s||(this.cachedElement[n]=e);const r=!V.disableCache&&this.cachedView[n];if(r)return t=r.document,e.ancestors&&r.setAncestors(e.ancestors),e.constraints&&r.setConstraints(e.constraints),e.attributes&&r.setAttributes(e.attributes),e.children&&r.setChildren(this.fetchCachedChildren(e.children)),r;if(!t)return;let a=V.components[o];a||(a=m.ComponentView);const l=new a(t,e.attributes);return(null===(i=k.MPEnv.platformGlobal())||void 0===i?void 0:i.mpDEBUG)&&l.htmlElement.setAttribute("mp-component",o),l.factory=this,l.engine=this.engine,l.hashCode=n,e.ancestors&&l.setAncestors(e.ancestors),e.constraints&&l.setConstraints(e.constraints),e.attributes&&l.setAttributes(e.attributes),e.children&&(V.disableCache?l.setChildren(e.children):l.setChildren(this.fetchCachedChildren(e.children))),V.disableCache||(this.cachedView[n]=l),l}createAncestors(e,t){const i=e["^"],s=e.name,o=e.hashCode;if(1==i&&"number"==typeof o)return this.cachedAncestor[o];if(!s||!o)return;i||(this.cachedElement[o]=e);const n=this.cachedAncestor[o];if(n){if(n.target&&n.target!==t){const e=n.target.ancestors.indexOf(n);e>=0&&n.target.ancestors.splice(e,1)}return n.target=t,e.attributes&&n.setAttributes(e.attributes),e.constraints&&n.setConstraints(e.constraints),n}if(!t)return;let r=V.ancestors[s];if(!r)return;const a=new r(t);return e.attributes&&a.setAttributes(e.attributes),e.constraints&&a.setConstraints(e.constraints),this.cachedAncestor[o]=a,a}fetchCachedChildren(e){return e.map((e=>{let t=e["^"],i=e.hashCode;return t&&this.cachedElement[i]?this.cachedElement[i]:e}))}callbackTextMeasureResult(e,t){this.textMeasureResults.push({measureId:e,size:t}),this.markedNeedsFlushTextMeasureResult||(this.markedNeedsFlushTextMeasureResult=!0,setTimeout((()=>{this.flushTextMeasureResult(),this.markedNeedsFlushTextMeasureResult=!1}),50))}flushTextMeasureResult(){this.textMeasureResults.length>0&&(this.engine.sendMessage(JSON.stringify({type:"rich_text",message:{event:"onMeasured",data:this.textMeasureResults}})),this.textMeasureResults=[])}}i.ComponentFactory=V,V.components={absorb_pointer:s.AbsorbPointer,clip_oval:o.ClipOval,clip_r_rect:n.ClipRRect,colored_box:r.ColoredBox,custom_paint:b.CustomPaint,custom_scroll_view:w.CustomScrollView,decorated_box:a.DecoratedBox,foreground_decorated_box:A.ForegroundDecoratedBox,editable_text:O.EditableText,gesture_detector:l.GestureDetector,grid_view:y.GridView,ignore_pointer:d.IgnorePointer,image:p.Image,list_view:f.ListView,offstage:c.Offstage,opacity:h.Opacity,overlay:E.Overlay,rich_text:g.RichText,text_span:g.TextSpan,widget_span:g.WidgetSpan,sliver_persistent_header:T.SliverPersistentHeader,transform:u.Transform,visibility:C.Visibility,mp_icon:P.MPIcon,mp_scaffold:v.MPScaffold,mp_video_view:M.MPVideoView,mp_web_view:S.MPWebView,mp_page_view:x.MPPageView,mp_platform_view:R.MPPlatformView,mp_mini_program_view:_.MPMiniProgramView},V.ancestors={opacity:h.OpacityAncestor,clip_r_rect:n.ClipRRectAncestor},V.disableCache=!1},{"../env":40,"./basic/absorb_pointer":2,"./basic/clip_oval":3,"./basic/clip_r_rect":4,"./basic/colored_box":6,"./basic/custom_paint":7,"./basic/custom_scroll_view":8,"./basic/decorated_box":9,"./basic/editable_text":10,"./basic/foreground_decorated_box":11,"./basic/gesture_detector":12,"./basic/grid_view":14,"./basic/ignore_pointer":15,"./basic/image":16,"./basic/list_view":17,"./basic/offstage":18,"./basic/opacity":19,"./basic/overlay":20,"./basic/rich_text":21,"./basic/sliver_persistent_header":22,"./basic/transform":23,"./basic/visibility":24,"./component_view":27,"./mpkit/icon":30,"./mpkit/miniprogram_view":31,"./mpkit/page_view":32,"./mpkit/platform_view":33,"./mpkit/scaffold":34,"./mpkit/video_view":35,"./mpkit/web_view":36}],27:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AncestorView=i.ComponentView=void 0;const s=e("./dom_utils");i.ComponentView=class{constructor(e,t){this.document=e,this.initialAttributes=t,this.classname="",this.subviews=[],this.disposed=!1,this.ancestors=[],this.ancestorStyle={},this.htmlElement=e.createElement(this.elementType())}dispose(){this.disposed=!0}elementType(){return"div"}setConstraints(e){e&&(this.constraints=e,this.updateLayout())}updateLayout(){var e,t,i,o,n;if(!this.constraints)return;let r=this.constraints.x,a=this.constraints.y,l=this.constraints.w,d=this.constraints.h;this.ancestors.forEach((e=>{e.constraints&&(r+=e.constraints.x,a+=e.constraints.y)}));let c=this.additionalConstraints;this.collectionViewConstraints&&this.superview&&"CollectionView"===this.superview.classname&&(c=this.collectionViewConstraints),this.gestureViewConstraints&&this.superview&&"GestureDetector"===this.superview.classname&&(r-=this.gestureViewConstraints.x,a-=this.gestureViewConstraints.y),this.platformViewConstraints&&this.superview&&"PlatformView"===this.superview.classname&&(r-=this.platformViewConstraints.x,a-=this.platformViewConstraints.y),(0,s.setDOMStyle)(this.htmlElement,{position:null!==(e=null==c?void 0:c.position)&&void 0!==e?e:"absolute",left:null!==(t=null==c?void 0:c.left)&&void 0!==t?t:r+"px",top:null!==(i=null==c?void 0:c.top)&&void 0!==i?i:a+"px",width:null!==(o=null==c?void 0:c.width)&&void 0!==o?o:l+"px",height:null!==(n=null==c?void 0:c.height)&&void 0!==n?n:d+"px"})}setAttributes(e){this.attributes=e}setChildren(e){if(!(e instanceof Array))return;let t=e.map((e=>this.factory.create(e,this.document))).filter((e=>e)),i=!1,s=-1;if(t.length!==this.subviews.length){i=!0;for(let e=0;e<t.length;e++)if(t[e]!==this.subviews[e]){s=e;break}}else{t.every(((e,t)=>e===this.subviews[t]&&e.superview===this))||(i=!0)}if(i)if(s>0){let e=[];for(let t=s;t<this.subviews.length;t++)e.push(this.subviews[t]);e.forEach((e=>e.removeFromSuperview()));for(let e=s;e<t.length;e++)this.addSubview(t[e])}else this.removeAllSubviews(),t.forEach((e=>this.addSubview(e)))}resetAncestorStyle(){this.ancestorStyle.opacity&&(this.ancestorStyle.opacity=1),this.ancestorStyle.borderRadius&&(this.ancestorStyle.borderRadius="unset"),this.ancestorStyle.overflow&&(this.ancestorStyle.overflow="unset"),this.ancestorStyle.borderTopLeftRadius&&(this.ancestorStyle.borderTopLeftRadius="unset"),this.ancestorStyle.borderTopRightRadius&&(this.ancestorStyle.borderTopRightRadius="unset"),this.ancestorStyle.borderBottomLeftRadius&&(this.ancestorStyle.borderBottomLeftRadius="unset"),this.ancestorStyle.borderBottomRightRadius&&(this.ancestorStyle.borderBottomRightRadius="unset")}setAncestors(e){!(e instanceof Array)&&this.ancestors.length>0?(this.resetAncestorStyle(),this.ancestors=[],(0,s.setDOMStyle)(this.htmlElement,this.ancestorStyle)):(this.resetAncestorStyle(),this.ancestors=e.map((e=>this.factory.createAncestors(e,this))).filter((e=>e)),(0,s.setDOMStyle)(this.htmlElement,this.ancestorStyle))}removeAllSubviews(){this.subviews.forEach((e=>{e.superview=void 0,e.htmlElement.remove()})),this.subviews=[]}removeFromSuperview(){var e;if(!this.superview)return;const t=this.superview.subviews.indexOf(this);t>=0&&(this.superview.subviews[t].htmlElement.remove(),null===(e=this.superview)||void 0===e||e.subviews.splice(t,1)),this.htmlElement.remove()}addSubview(e){e.superview&&e.removeFromSuperview(),this.subviews.push(e),e.superview=this,this.htmlElement.appendChild(e.htmlElement),e.didMoveToWindow()}didMoveToWindow(){this.subviews.forEach((e=>e.didMoveToWindow()))}};i.AncestorView=class{constructor(e){this.target=e}setConstraints(e){e&&(this.constraints=e,this.target.updateLayout())}setAttributes(e){}}},{"./dom_utils":29}],28:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.wrapDartObject=void 0;i.wrapDartObject=e=>null==e||"string"==typeof e||"number"==typeof e||"boolean"==typeof e?e:e instanceof Array?e.map((e=>(0,i.wrapDartObject)(e))):(e.o&&(e=e.o),new Proxy(e,{get:function(e,t){var s,o,n,r,a,l,d,c,h,u,p,m;let v=null!==(m=null!==(h=null!==(l=null!==(n=null===(o=null===(s=null==e?void 0:e.b)||void 0===s?void 0:s[t])||void 0===o?void 0:o.b)&&void 0!==n?n:null===(a=null===(r=null==e?void 0:e.c)||void 0===r?void 0:r[t])||void 0===a?void 0:a.b)&&void 0!==l?l:null===(c=null===(d=null==e?void 0:e._nums)||void 0===d?void 0:d[t])||void 0===c?void 0:c.hashMapCellValue)&&void 0!==h?h:null===(p=null===(u=null==e?void 0:e._strings)||void 0===u?void 0:u[t])||void 0===p?void 0:p.hashMapCellValue)&&void 0!==m?m:e[t];return(0,i.wrapDartObject)(v)}}))},{}],29:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.setDOMAttribute=i.setDOMStyle=void 0;i.setDOMStyle=(e,t)=>{if(0!==Object.keys(t).length){for(const e in t){const i=t[e];"string"==typeof i&&i.indexOf(".0px")>0&&(t[e]=i.replace(".0px","px"))}for(const i in t)e.style[i]=t[i]}};i.setDOMAttribute=(e,t,i)=>{void 0===e.attributes&&(e.attributes={}),e.attributes[t]!==i&&(e.attributes[t]=i,void 0===i?e.removeAttribute(t):e.setAttribute(t,i))}},{}],30:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.MPIcon=void 0;const s=e("../component_view"),o=e("../dom_utils"),n=e("../utils");class r extends s.ComponentView{setChildren(){}setAttributes(e){super.setAttributes(e),(0,o.setDOMStyle)(this.htmlElement,{backgroundColor:(0,n.cssColor)(e.color),mask:`url(${e.iconUrl}) no-repeat center`,webkitMask:`url(${e.iconUrl}) no-repeat center`,WebkitMask:`url(${e.iconUrl}) no-repeat center`,width:"24px",height:"24px",transform:`scale(${e.size/24}, ${e.size/24})`,transformOrigin:"top left"})}}i.MPIcon=r},{"../component_view":27,"../dom_utils":29,"../utils":37}],31:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.MPMiniProgramView=void 0;const s=e("../../components/mpkit/platform_view"),o=e("../dom_utils");class n extends s.MPPlatformView{constructor(){super(...arguments),this.eventListened={}}elementType(){var e;return"wx-"+(null===(e=this.initialAttributes)||void 0===e?void 0:e.tag)}setAttributes(e){super.setAttributes(e);for(const t in e)"style"===t?(0,o.setDOMStyle)(this.htmlElement,e[t]):0===t.indexOf("on.")?this.addEventListener(t,e[t]):(0,o.setDOMAttribute)(this.htmlElement,t,e[t])}addEventListener(e,t){this.eventListened[e]?this.eventListened[e]=t:(this.eventListened[e]=t,this.htmlElement.addEventListener(e.replace("on.",""),(t=>{const i=this.eventListened[e];if(0===i.length)return void this.invokeMethod(e,t.detail);let s={};i.forEach((e=>{var i;s[e]=null===(i=t.detail)||void 0===i?void 0:i[e]})),this.invokeMethod(e,s)})))}}i.MPMiniProgramView=n},{"../../components/mpkit/platform_view":33,"../dom_utils":29}],32:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.MPPageView=void 0;const s=e("../../env"),o=e("../component_view"),n=e("../dom_utils");o.ComponentView;class r extends o.ComponentView{elementType(){return"wx-swiper"}setAttributes(e){super.setAttributes(e),(0,n.setDOMAttribute)(this.htmlElement,"vertical","Axis.vertical"===e.scrollDirection),(0,n.setDOMAttribute)(this.htmlElement,"circular",!!e.loop)}addSubview(e){e.superview&&e.removeFromSuperview(),this.subviews.push(e),e.superview=this;let t=this.document.createElement("wx-swiper-item");t.appendChild(e.htmlElement),this.htmlElement.appendChild(t),e.didMoveToWindow()}}i.MPPageView=(()=>{if(s.MPEnv.platformType===s.PlatformType.wxMiniProgram||s.MPEnv.platformType===s.PlatformType.swanMiniProgram)return r;throw s.MPEnv.platformType,s.PlatformType.browser,"None of PageView class."})()},{"../../env":40,"../component_view":27,"../dom_utils":29}],33:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.MPPlatformView=void 0;const s=e("../.."),o=e("../../env"),n=e("../component_view");class r extends n.ComponentView{constructor(e,t){super(e,t),this.document=e,this.initialAttributes=t,this.classname="PlatformView",this.elementType().indexOf(".")>0&&s.MPEnv.platformType===o.PlatformType.browser&&(this.htmlElement=this.createFromWebTemplate())}static handleInvokeMethodCallback(e,t){this._invokeMethodCompleter[e]&&(this._invokeMethodCompleter[e](t),delete this._invokeMethodCompleter[e])}elementType(){return"div"}setSize(e){this._currentSize&&this._currentSize.width===e.width&&this._currentSize.height===e.height||(this._currentSize=e,this.engine.sendMessage(JSON.stringify({type:"platform_view",message:{event:"setSize",hashCode:this.hashCode,size:e}})))}createFromWebTemplate(){return null}setChildren(e){super.setChildren(e),this.subviews.forEach((e=>{var t,i,s,o;e.platformViewConstraints={x:null!==(i=null===(t=this.constraints)||void 0===t?void 0:t.x)&&void 0!==i?i:0,y:null!==(o=null===(s=this.constraints)||void 0===s?void 0:s.y)&&void 0!==o?o:0},e.updateLayout()}))}onMethodCall(e,t){}invokeMethod(e,t,i=!1){let s=`${this.hashCode}_${Math.random()}`;if(this.engine.sendMessage(JSON.stringify({type:"platform_view",message:{event:"methodCall",hashCode:this.hashCode,method:e,params:t,seqId:s,requireResult:i}})),i)return new Promise((e=>{r._invokeMethodCompleter[s]=e}))}}i.MPPlatformView=r,r._invokeMethodCompleter={}},{"../..":41,"../../env":40,"../component_view":27}],34:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.MPScaffold=void 0;const s=e("../component_view"),o=e("../dom_utils"),n=e("../utils");class r extends s.ComponentView{constructor(){super(...arguments),this.attached=!1}setAppBar(e){var t;this.appBar===e&&!0!==(null===(t=e)||void 0===t?void 0:t.collectionViewFixed)||(this.removeAllSubviews(),this.appBar=e,e&&(e.collectionViewFixed=!1,(0,o.setDOMStyle)(e.htmlElement,{pointerEvents:"unset",display:"unset"}),e.subviews.forEach((e=>{(0,o.setDOMStyle)(e.htmlElement,{position:"absolute",marginTop:"0px"})}))),e&&this.engine.pageMode&&(e.additionalConstraints={position:"fixed"},(0,o.setDOMStyle)(e.htmlElement,{position:"fixed",zIndex:"9999"})),this.readdSubviews())}setBody(e){this.body!==e&&(this.removeAllSubviews(),this.body=e,this.readdSubviews())}setBottomBar(e,t,i){this.bottomBar!==e&&(this.removeAllSubviews(),this.bottomBar=e,e&&this.engine.pageMode&&(e.additionalConstraints={position:"fixed",top:"unset"},(0,o.setDOMStyle)(e.htmlElement,{position:"fixed",top:"unset",bottom:"0px",zIndex:"9999",paddingBottom:!0===t?"env(safe-area-inset-bottom)":"",backgroundColor:i?(0,n.cssColor)(i):void 0})),this.readdSubviews())}setFloatingBody(e){this.floatingBody!==e&&(this.removeAllSubviews(),this.floatingBody=e,e&&this.engine.pageMode&&(e.additionalConstraints={position:"fixed",zIndex:"9999"},(0,o.setDOMStyle)(e.htmlElement,{position:"fixed"})),this.readdSubviews())}readdSubviews(){this.body&&this.addSubview(this.body),this.appBar&&this.addSubview(this.appBar),this.bottomBar&&this.addSubview(this.bottomBar),this.floatingBody&&this.addSubview(this.floatingBody)}setAttributes(e){var t,i,s,r,a;super.setAttributes(e),this.setAppBar(e.appBar?this.factory.create(e.appBar,this.document):void 0),this.setBody(e.body?this.factory.create(e.body,this.document):void 0),this.setBottomBar(e.bottomBar?this.factory.create(e.bottomBar,this.document):void 0,e.bottomBarWithSafeArea,e.bottomBarSafeAreaColor),this.setFloatingBody(e.floatingBody?this.factory.create(e.floatingBody,this.document):void 0),e.name?null===(t=this.delegate)||void 0===t||t.setPageTitle(e.name):null===(i=this.delegate)||void 0===i||i.setPageTitle(""),this.delegate?e.backgroundColor?null===(s=this.delegate)||void 0===s||s.setPageBackgroundColor((0,n.cssColorHex)(e.backgroundColor)):null===(r=this.delegate)||void 0===r||r.setPageBackgroundColor("transparent"):(0,o.setDOMStyle)(this.htmlElement,{backgroundColor:e.backgroundColor?(0,n.cssColor)(e.backgroundColor):"unset"}),e.appBarColor&&(null===(a=this.delegate)||void 0===a||a.setAppBarColor((0,n.cssColorHex)(e.appBarColor),e.appBarTintColor?(0,n.cssColorHex)(e.appBarTintColor):"#000000"))}setDelegate(e){this.delegate=e}onRefresh(){return new Promise((e=>{this.refreshEndResolver=e,this.engine.sendMessage(JSON.stringify({type:"scaffold",message:{event:"onRefresh",target:this.hashCode}}))}))}onWechatMiniProgramShareAppMessage(){return new Promise((e=>{this.onWechatMiniProgramShareAppMessageResolver=e,this.engine.sendMessage(JSON.stringify({type:"scaffold",message:{event:"onWechatMiniProgramShareAppMessage",target:this.hashCode}}))}))}onReachBottom(){this.engine.sendMessage(JSON.stringify({type:"scaffold",message:{event:"onReachBottom",target:this.hashCode}}))}onPageScroll(e){this.attributes.onPageScroll&&this.engine.sendMessage(JSON.stringify({type:"scaffold",message:{event:"onPageScroll",target:this.hashCode,scrollTop:e}}))}setChildren(){}}i.MPScaffold=r},{"../component_view":27,"../dom_utils":29,"../utils":37}],35:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.MPVideoView=void 0;const s=e("../../env"),o=e("../dom_utils"),n=e("./platform_view");class r extends n.MPPlatformView{elementType(){return"video"}onMethodCall(e,t){return __awaiter(this,void 0,void 0,(function*(){s.MPEnv.platformType===s.PlatformType.browser?this.onBrowserMethodCall(e,t):s.MPEnv.platformType===s.PlatformType.wxMiniProgram&&(this.videoContext||(this.videoContext=yield this.htmlElement.$$getContext()),this.videoContext&&this.onMiniProgramMethodCall(e,t))}))}onBrowserMethodCall(e,t){}onMiniProgramMethodCall(e,t){"play"===e?this.videoContext.play():"pause"===e?this.videoContext.pause():"setVolume"===e||"volumeUp"===e||"volumeDown"===e||("setMuted"===e?this.videoContext.muted=t.muted:"fullscreen"===e?this.videoContext.requestFullScreen():"setPlaybackRate"===e?this.videoContext.playbackRate(t.playbackRate):"seekTo"===e&&this.videoContext.seek(t.seekTo))}setAttributes(e){super.setAttributes(e),(0,o.setDOMAttribute)(this.htmlElement,"src",e.url),e.controls&&(0,o.setDOMAttribute)(this.htmlElement,"controls",e.controls),e.autoplay&&(0,o.setDOMAttribute)(this.htmlElement,"autoplay",e.autoplay),e.loop&&(0,o.setDOMAttribute)(this.htmlElement,"loop",e.loop),e.muted&&(0,o.setDOMAttribute)(this.htmlElement,"muted",e.muted),e.poster&&(0,o.setDOMAttribute)(this.htmlElement,"poster",e.poster)}setChildren(){}}i.MPVideoView=r},{"../../env":40,"../dom_utils":29,"./platform_view":33}],36:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.MPWebView=void 0;const s=e("../.."),o=e("../../env"),n=e("../dom_utils"),r=e("./platform_view");class a extends r.MPPlatformView{constructor(e,t){super(e,t),this.document=e,this.initialAttributes=t,s.MPEnv.platformType!==o.PlatformType.wxMiniProgram&&s.MPEnv.platformType!==o.PlatformType.swanMiniProgram||this.htmlElement.addEventListener("message",(e=>{var t;(null===(t=null==e?void 0:e.detail)||void 0===t?void 0:t.data)instanceof Array&&this.invokeMethod("mini_program_message",{data:e.detail.data})}))}elementType(){return s.MPEnv.platformType===o.PlatformType.wxMiniProgram||s.MPEnv.platformType===o.PlatformType.swanMiniProgram?"wx-web-view":"iframe"}onMethodCall(e,t){"reload"===e?((0,n.setDOMAttribute)(this.htmlElement,"src",""),(0,n.setDOMAttribute)(this.htmlElement,"src",this.attributes.url)):"loadUrl"===e&&(null==t?void 0:t.url)&&((0,n.setDOMAttribute)(this.htmlElement,"src",""),(0,n.setDOMAttribute)(this.htmlElement,"src",t.url))}setAttributes(e){super.setAttributes(e),(0,n.setDOMAttribute)(this.htmlElement,"src",e.url),(0,n.setDOMStyle)(this.htmlElement,{border:"none"})}setChildren(){}}i.MPWebView=a},{"../..":41,"../../env":40,"../dom_utils":29,"./platform_view":33}],37:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.cssSizeFromMPElement=i.cssPadding=i.cssTextStyle=i.cssTextAlign=i.cssBorder=i.cssOffset=i.cssGradient=i.cssBorderRadius=i.cssColorHex=i.cssColor=void 0;i.cssColor=e=>{const t=parseInt(e);let i=(t>>16&255).toString(16);i.length<2&&(i="0"+i);let s=(t>>8&255).toString(16);s.length<2&&(s="0"+s);let o=(t>>0&255).toString(16);o.length<2&&(o="0"+o);let n=(t>>24&255).toString(16);return"ff"===n?`#${i}${s}${o}`:(n.length<2&&(n="0"+n),`rgba(${t>>16&255},${t>>8&255},${t>>0&255},${(t>>24&255)/255})`)};i.cssColorHex=e=>{const t=parseInt(e);let i=(t>>16&255).toString(16);i.length<2&&(i="0"+i);let s=(t>>8&255).toString(16);s.length<2&&(s="0"+s);let o=(t>>0&255).toString(16);return o.length<2&&(o="0"+o),`#${i}${s}${o}`};i.cssBorderRadius=e=>{var t,i,s,o,n,r,a,l;if(0===e.indexOf("BorderRadius.circular(")){return{borderRadius:e.replace("BorderRadius.circular(","").replace(")","")+"px"}}if(0===e.indexOf("BorderRadius.all(")){return{borderRadius:e.replace("BorderRadius.all(","").replace(")","")+"px"}}if(0===e.indexOf("BorderRadius.only(")){const d=e.replace("BorderRadius.only(","").replace(/\)/gi,"").replace(/Radius.circular\(/gi,"");return{borderTopLeftRadius:`${null!==(i=null===(t=d.match(/topLeft: ([0-9|.]+)/))||void 0===t?void 0:t[1])&&void 0!==i?i:0}px`,borderTopRightRadius:`${null!==(o=null===(s=d.match(/topRight: ([0-9|.]+)/))||void 0===s?void 0:s[1])&&void 0!==o?o:0}px`,borderBottomLeftRadius:`${null!==(r=null===(n=d.match(/bottomLeft: ([0-9|.]+)/))||void 0===n?void 0:n[1])&&void 0!==r?r:0}px`,borderBottomRightRadius:`${null!==(l=null===(a=d.match(/bottomRight: ([0-9|.]+)/))||void 0===a?void 0:a[1])&&void 0!==l?l:0}px`}}return{}};i.cssGradient=e=>{if(!e)return"";if("LinearGradient"===e.classname){let t=(()=>{switch(e.end){case"centerRight":return"to right";case"centerLeft":return"to left";case"topRight":return"to top right";case"bottomRight":return"to bottom right";case"topLeft":return"to top left";case"bottomLeft":return"to bottom left";case"topCenter":return"to top";case"bottomCenter":return"to bottom"}})(),s=[];return s=e.stops&&e.stops.length?e.colors.map(((t,s)=>void 0!==e.stops[s]?`${(0,i.cssColor)(t)} ${(100*e.stops[s]).toFixed(0)}%`:(0,i.cssColor)(t))):e.colors.map((e=>(0,i.cssColor)(e))),`linear-gradient(${t}, ${s.join(", ")})`}return""};i.cssOffset=e=>{if(0===e.indexOf("Offset(")){const t=e.replace("Offset(","").replace(")","").split(",").map((e=>e.trim()));return{dx:t[0],dy:t[1]}}};i.cssBorder=e=>{let t={};return"BorderStyle.none"!==e.topStyle&&(t.borderTopWidth=0===e.topWidth?`${(1/window.devicePixelRatio).toFixed(2)}px`:e.topWidth+"px",t.borderTopColor=(0,i.cssColor)(e.topColor),t.borderTopStyle="solid"),"BorderStyle.none"!==e.leftStyle&&(t.borderLeftWidth=0===e.leftWidth?`${(1/window.devicePixelRatio).toFixed(2)}px`:e.leftWidth+"px",t.borderLeftColor=(0,i.cssColor)(e.leftColor),t.borderLeftStyle="solid"),"BorderStyle.none"!==e.bottomStyle&&(t.borderBottomWidth=0===e.bottomWidth?`${(1/window.devicePixelRatio).toFixed(2)}px`:e.bottomWidth+"px",t.borderBottomColor=(0,i.cssColor)(e.bottomColor),t.borderBottomStyle="solid"),"BorderStyle.none"!==e.rightStyle&&(t.borderRightWidth=0===e.rightWidth?`${(1/window.devicePixelRatio).toFixed(2)}px`:e.rightWidth+"px",t.borderRightColor=(0,i.cssColor)(e.rightColor),t.borderRightStyle="solid"),t};i.cssTextAlign=e=>null==e?void 0:e.replace("TextAlign.",""),i.cssTextStyle=function(e){var t;let s={userSelect:"none",WebkitUserSelect:"none"};return null!=e&&(e.fontFamily&&(s.fontFamily=e.fontFamily),null!=e.fontSize&&(s.fontSize=`${(null!==(t=e.fontSize)&&void 0!==t?t:14).toString()}px`),null!=e.color&&(s.color=(0,i.cssColor)(e.color)),e.fontWeight&&(s.fontWeight=function(e){if(e.fontWeight)return e.fontWeight.replace("FontWeight.w","")}(e)),e.fontStyle&&(s.fontStyle=function(e){if("FontStyle.italic"===e.fontStyle)return"italic"}(e)),e.letterSpacing&&(s.letterSpacing=e.letterSpacing),e.wordSpacing&&(s.wordSpacing=e.wordSpacing),e.textBaseline&&(s.alignmentBaseline=function(e){return"TextBaseline.alphabetic"===e.textBaseline?"alphabetic":"TextBaseline.ideographic"===e.textBaseline?"ideographic":void 0}(e)),e.height&&(s.lineHeight=e.height),null!=e.backgroundColor&&(s.backgroundColor=(0,i.cssColor)(e.backgroundColor)),e.decoration&&("TextDecoration.lineThrough"===e.decoration?s.textDecoration="line-through":"TextDecoration.underline"===e.decoration&&(s.textDecoration="underline"))),s};i.cssPadding=e=>{if(!e)return{};if(0===e.indexOf("EdgeInsets.zero"))return{};if(0===e.indexOf("EdgeInsets.all(")){const t=e.replace("EdgeInsets.all(","").replace(")","");return{paddingLeft:t+"px",paddingTop:t+"px",paddingRight:t+"px",paddingBottom:t+"px"}}if(0===e.indexOf("EdgeInsets(")){const t=e.replace("EdgeInsets(","").replace(")","").split(",").map((e=>e.trim()));return{paddingLeft:t[0]+"px",paddingTop:t[1]+"px",paddingRight:t[2]+"px",paddingBottom:t[3]+"px"}}return{}};i.cssSizeFromMPElement=e=>{if(!e)return{width:0,height:0};let t=0,s=0;if(e.constraints&&"number"==typeof e.constraints.w&&"number"==typeof e.constraints.h&&e.constraints.w>0&&e.constraints.h>0)t=e.constraints.w,s=e.constraints.h;else if(e.children instanceof Array&&1===e.children.length)return(0,i.cssSizeFromMPElement)(e.children[0]);return{width:t,height:s}}},{}],38:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.createDebugger=void 0;const s=e("../env");i.createDebugger=function(e,t){return s.MPEnv.platformType===s.PlatformType.wxMiniProgram||s.MPEnv.platformType===s.PlatformType.swanMiniProgram?new n(e,t):null};const o=()=>{switch(s.MPEnv.platformType){case s.PlatformType.browser:return"browser";case s.PlatformType.wxMiniProgram:return"wechatMiniProgram";default:return"unknown"}};class n{constructor(e,t){this.serverAddr=e,this.engine=t,this.messageQueue=[],this.connected=!1}start(){this.socket=s.MPEnv.platformScope.connectSocket({url:`ws://${this.serverAddr}/ws?clientType=${o()}`}),this.socket.onOpen((()=>{this.connected=!0,this.socketDidConnect()})),this.socket.onMessage((e=>{"string"==typeof e.data&&this.socketDidReceiveMessage(e.data)})),this.socket.onClose((()=>{this.connected&&(this.engine.componentFactory.cachedElement={},this.engine.componentFactory.cachedView={},s.MPEnv.platformScope.reLaunch({url:(()=>{try{return"/"+s.MPEnv.platformScope.getLaunchOptionsSync().path+"?"+this.encodePathParams(s.MPEnv.platformScope.getLaunchOptionsSync().query)}catch(e){return"/pages/index/index"}})()})),this.connected=!1,this.socketDidDisconnect()}))}encodePathParams(e){let t=[];if(e)for(const i in e)t.push(`${i}=${encodeURIComponent(e[i])}`);return t.join("&")}socketDidConnect(){this.messageQueue.forEach((e=>{var t;null===(t=this.socket)||void 0===t||t.send({data:e})})),this.messageQueue=[]}socketDidDisconnect(){setTimeout((()=>{this.start()}),1e3)}socketDidReceiveMessage(e){this.engine.didReceivedMessage(e)}sendMessage(e){this.socket&&this.connected?this.socket.send({data:e}):this.messageQueue.push(e)}}},{"../env":40}],39:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Engine=void 0;const custom_paint_1=require("./components/basic/custom_paint"),web_dialogs_1=require("./components/basic/web_dialogs"),component_factory_1=require("./components/component_factory"),platform_view_1=require("./components/mpkit/platform_view"),debugger_1=require("./debugger/debugger"),env_1=require("./env"),method_channel_handler_1=require("./mpjs/method_channel_handler"),mpjs_1=require("./mpjs/mpjs"),text_measurer_1=require("./text_measurer"),window_info_1=require("./window_info"),dart_object_1=require("./components/dart_object");class Engine{constructor(){this.started=!1,this.messageQueue=[],this.managedViews={},this.unmanagedViewFrameData={},this.mpJS=new mpjs_1.MPJS(this),this.windowInfo=new window_info_1.WindowInfo(this),this.pageMode=!1,this.componentFactory=new component_factory_1.ComponentFactory(this),this.drawable=new custom_paint_1.MPDrawable(this),method_channel_handler_1.MethodChannelHandler.installHandler()}static codeBlockWithCodePath(codePath){return new Promise(((res,rej)=>{const httpRequest=new XMLHttpRequest;httpRequest.onload=()=>{res((()=>{eval(httpRequest.response)}))},httpRequest.onerror=e=>{rej(e)},httpRequest.open("GET",codePath),httpRequest.send()}))}static codeBlockWithFile(e){return()=>{require(e).main()}}static registerPlatformView(e,t){component_factory_1.ComponentFactory.components[e]=t}initWithDebuggerServerAddr(e){this.debugger=(0,debugger_1.createDebugger)(e,this)}initWithCodeBlock(e){this.codeBlock=e}start(){this.started||(this.codeBlock||this.debugger)&&(this.windowInfo.updateWindowInfo(),this.listenViewport(),env_1.MPEnv.platformGlobal(),env_1.MPEnv.platformType===env_1.PlatformType.browser?env_1.MPEnv.platformGlobal().engineScope=this.mpJS.engineScope:(env_1.MPEnv.platformGlobal().JSON=JSON,env_1.MPEnv.platformGlobal().setTimeout=setTimeout,env_1.MPEnv.platformGlobal().setInterval=setInterval,env_1.MPEnv.platformGlobal().clearTimeout=function(e){clearTimeout(e)},env_1.MPEnv.platformGlobal().clearInterval=function(e){clearInterval(e)},env_1.MPEnv.platformGlobal().engineScope=this.mpJS.engineScope,env_1.MPEnv.platformGlobal().Object=Object,"undefined"!=typeof wx&&(env_1.MPEnv.platformGlobal().wx=wx,env_1.MPEnv.platformGlobal().uni=wx),"undefined"!=typeof swan&&(env_1.MPEnv.platformGlobal().swan=swan,env_1.MPEnv.platformGlobal().uni=swan)),this.debugger&&this.debugger.start(),this.codeBlock&&(this.mpJS.engineScope.onMessage=e=>{this.didReceivedMessage(e)},this.mpJS.engineScope.onMapMessage=e=>{this.didReceivedMessage(e,!0)},(()=>{this.codeBlock()})(),this.flushQueueMessage()),this.started=!0)}sendMessage(e){var t;(null===(t=env_1.MPEnv.platformGlobal())||void 0===t?void 0:t.mpDEBUG)&&console.log((new Date).getTime(),"out",JSON.parse(e)),this.debugger?this.debugger.sendMessage(e):this.mpJS.engineScope.postMessage?this.mpJS.engineScope.postMessage(e):this.messageQueue.push(e)}flushQueueMessage(){this.debugger||this.mpJS.engineScope.postMessage&&this.messageQueue.forEach((e=>{this.mpJS.engineScope.postMessage(e)}))}didReceivedMessage(e,t=!1){var i,s,o,n,r;let a=t?(0,dart_object_1.wrapDartObject)(e):JSON.parse(e);a&&((null===(i=env_1.MPEnv.platformGlobal())||void 0===i?void 0:i.mpDEBUG)&&console.log((new Date).getTime(),"in",a),"frame_data"===a.type?this.didReceivedFrameData(a.message):"diff_data"===a.type?this.didReceivedDiffData(a.message):"element_gc"===a.type?a.message instanceof Array&&this.didReceivedElementGC(a.message):"decode_drawable"===a.type?this.drawable.decodeDrawable(a.message):"route"===a.type?null===(n=null!==(o=null===(s=this.app)||void 0===s?void 0:s.router)&&void 0!==o?o:this.router)||void 0===n||n.didReceivedRouteData(a.message):"mpjs"===a.type?this.didReceivedMPJS(a):"action:web_dialogs"===a.type?web_dialogs_1.WebDialogs.receivedWebDialogsMessage(this,a.message):"scaffold"===a.type?this.didReceivedScaffold(a.message):"rich_text"===a.type&&"doMeasure"===(null===(r=a.message)||void 0===r?void 0:r.event)?text_measurer_1.TextMeasurer.didReceivedDoMeasureData(this,a.message):"platform_view"===a.type&&this.didReceivedPlatformView(a.message))}didReceivedFrameData(e){var t;if(!e)return;const i=e.routeId;if(void 0===this.managedViews[i])return this.unmanagedViewFrameData[i]||(this.unmanagedViewFrameData[i]=[]),void this.unmanagedViewFrameData[i].push(e);"number"==typeof i&&(null===(t=this.managedViews[i])||void 0===t||t.didReceivedFrameData(e))}didReceivedDiffData(e){e&&e.diffs.forEach((e=>{this.componentFactory.create(e,void 0),this.componentFactory.createAncestors(e,void 0)}))}didReceivedElementGC(e){e.forEach((e=>{var t;null===(t=this.componentFactory.cachedView[e])||void 0===t||t.dispose(),delete this.componentFactory.cachedElement[e],delete this.componentFactory.cachedView[e]}))}didReceivedScaffold(e){var t,i;if("onRefreshEnd"===e.event){let i=this.componentFactory.cachedView[e.target];i&&(null===(t=i.refreshEndResolver)||void 0===t||t.call(i,void 0),i.refreshEndResolver=void 0)}else if("onWechatMiniProgramShareAppMessageResolve"===e.event){let t=this.componentFactory.cachedView[e.target];t&&(null===(i=t.onWechatMiniProgramShareAppMessageResolver)||void 0===i||i.call(t,e.params),t.onWechatMiniProgramShareAppMessageResolver=void 0)}}didReceivedMPJS(e){this.mpJS.handleMessage(e.message,(t=>{this.sendMessage(JSON.stringify({type:"mpjs",message:{requestId:e.message.requestId,result:t}}))}),((e,t)=>{this.sendMessage(JSON.stringify({type:"mpjs",message:{funcId:e,arguments:t}}))}))}didReceivedPlatformView(e){return __awaiter(this,void 0,void 0,(function*(){if("methodCall"===e.event){let t=this.componentFactory.cachedView[e.hashCode];if(t){const i=yield t.onMethodCall(e.method,e.params);e.requireResult&&this.sendMessage(JSON.stringify({type:"platform_view",message:{event:"methodCallCallback",seqId:e.seqId,result:i}}))}}else if("methodCallCallback"===e.event){const t=e.seqId;"string"==typeof t&&platform_view_1.MPPlatformView.handleInvokeMethodCallback(t,e.result)}}))}listenViewport(){env_1.MPEnv.platformType===env_1.PlatformType.browser&&window.addEventListener("resize",(()=>{this.sendViewportChangeEvent()}))}sendViewportChangeEvent(){this.sendViewportHandler&&clearTimeout(this.sendViewportHandler),this.sendViewportHandler=setTimeout((()=>{var e,t;this.windowInfo.updateWindowInfo(),null===(t=null===(e=this.app)||void 0===e?void 0:e.router)||void 0===t||t.history.forEach((e=>{e.item.viewportChanged()})),this.sendViewportHandler=void 0}),32)}}exports.Engine=Engine},{"./components/basic/custom_paint":7,"./components/basic/web_dialogs":25,"./components/component_factory":26,"./components/dart_object":28,"./components/mpkit/platform_view":33,"./debugger/debugger":38,"./env":40,"./mpjs/method_channel_handler":43,"./mpjs/mpjs":44,"./text_measurer":47,"./window_info":48}],40:[function(e,t,i){(function(e){(function(){"use strict";var t;Object.defineProperty(i,"__esModule",{value:!0}),i.MPEnv=i.PlatformType=void 0,function(e){e[e.unknown=0]="unknown",e[e.browser=1]="browser",e[e.wxMiniProgram=2]="wxMiniProgram",e[e.swanMiniProgram=3]="swanMiniProgram"}(t=i.PlatformType||(i.PlatformType={}));let s={};i.MPEnv={platformType:"undefined"!=typeof wx&&"function"==typeof wx.getSystemInfoSync?t.wxMiniProgram:"undefined"!=typeof swan&&"function"==typeof swan.getSystemInfoSync?t.swanMiniProgram:t.browser,platformScope:"undefined"!=typeof wx&&"function"==typeof wx.getSystemInfoSync?wx:"undefined"!=typeof swan&&"function"==typeof swan.getSystemInfoSync?swan:void 0,platformAppInstance:void 0,platformGlobal:()=>i.MPEnv.platformAppInstance?i.MPEnv.platformAppInstance:"function"==typeof getApp?getApp():"undefined"!=typeof window?window:void 0!==e?e:s,platformPC:()=>{if(i.MPEnv.platformType===t.wxMiniProgram){const e=i.MPEnv.platformScope.getSystemInfoSync().platform;if("mac"===e||"windows"===e)return!0}else if(i.MPEnv.platformType===t.browser)return 1===(null===navigator||void 0===navigator?void 0:navigator.maxTouchPoints);return!1},platformWindow:e=>e&&e.window?e.window:"undefined"!=typeof window?window:void 0}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],41:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.MPEnv=i.ComponentFactory=i.setDOMStyle=i.setDOMAttribute=i.MPPlatformView=i.BrowserApp=i.Page=i.Engine=void 0;var s=e("./engine");Object.defineProperty(i,"Engine",{enumerable:!0,get:function(){return s.Engine}});var o=e("./page");Object.defineProperty(i,"Page",{enumerable:!0,get:function(){return o.Page}});var n=e("./browser_app");Object.defineProperty(i,"BrowserApp",{enumerable:!0,get:function(){return n.BrowserApp}});var r=e("./components/mpkit/platform_view");Object.defineProperty(i,"MPPlatformView",{enumerable:!0,get:function(){return r.MPPlatformView}});var a=e("./components/dom_utils");Object.defineProperty(i,"setDOMAttribute",{enumerable:!0,get:function(){return a.setDOMAttribute}}),Object.defineProperty(i,"setDOMStyle",{enumerable:!0,get:function(){return a.setDOMStyle}});var l=e("./components/component_factory");Object.defineProperty(i,"ComponentFactory",{enumerable:!0,get:function(){return l.ComponentFactory}});var d=e("./env");Object.defineProperty(i,"MPEnv",{enumerable:!0,get:function(){return d.MPEnv}})},{"./browser_app":1,"./components/component_factory":26,"./components/dom_utils":29,"./components/mpkit/platform_view":33,"./engine":39,"./env":40,"./page":45}],42:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.MPEnv=i.ComponentFactory=i.setDOMStyle=i.setDOMAttribute=i.MPPlatformView=i.WXPage=i.WXApp=i.Page=i.Engine=void 0;var s=e("./engine");Object.defineProperty(i,"Engine",{enumerable:!0,get:function(){return s.Engine}});var o=e("./page");Object.defineProperty(i,"Page",{enumerable:!0,get:function(){return o.Page}});var n=e("./wx_app");Object.defineProperty(i,"WXApp",{enumerable:!0,get:function(){return n.WXApp}}),Object.defineProperty(i,"WXPage",{enumerable:!0,get:function(){return n.WXPage}});var r=e("./components/mpkit/platform_view");Object.defineProperty(i,"MPPlatformView",{enumerable:!0,get:function(){return r.MPPlatformView}});var a=e("./components/dom_utils");Object.defineProperty(i,"setDOMAttribute",{enumerable:!0,get:function(){return a.setDOMAttribute}}),Object.defineProperty(i,"setDOMStyle",{enumerable:!0,get:function(){return a.setDOMStyle}});var l=e("./components/component_factory");Object.defineProperty(i,"ComponentFactory",{enumerable:!0,get:function(){return l.ComponentFactory}});var d=e("./env");Object.defineProperty(i,"MPEnv",{enumerable:!0,get:function(){return d.MPEnv}})},{"./components/component_factory":26,"./components/dom_utils":29,"./components/mpkit/platform_view":33,"./engine":39,"./env":40,"./page":45,"./wx_app":49}],43:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.MethodChannelHandler=void 0;const s=e("../env");i.MethodChannelHandler=class{static installHandler(){s.MPEnv.platformGlobal().mp_core_methodChannelHandlerWebOnly=this.handler}static handler(e,t,i,o,n){return __awaiter(this,void 0,void 0,(function*(){if(Object.prototype.hasOwnProperty.call(s.MPEnv.platformGlobal(),e))if("function"==typeof s.MPEnv.platformGlobal()[e][t])try{let r=yield s.MPEnv.platformGlobal()[e][t](i,n);o(JSON.stringify(r))}catch(e){o("ERROR:"+e)}else o("NOTIMPLEMENTED");else o("NOTIMPLEMENTED")}))}}},{"../env":40}],44:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.MPJS=void 0;const s=e("../env");i.MPJS=class{constructor(e){this.engine=e,this.engineScope={},this.objectRefs={}}handleMessage(e,t,i){"callMethod"===e.event?this.callMethod(e,t,i):"getValue"===e.event?this.getValue(e,t):"setValue"===e.event?this.setValue(e,t):"hasProperty"===e.event?this.hasProperty(e,t):"deleteProperty"===e.event&&this.deleteProperty(e,t)}callMethod(e,t,i){var s;const o=e.params,n=this.getCallee(o.objectHandler,o.callChain);if("object"==typeof n||"function"==typeof n)try{const e=n[o.method].apply(n,null===(s=o.args)||void 0===s?void 0:s.map((e=>this.wrapArgument(e,i))));t(this.wrapResult(e))}catch(e){console.error(e)}}getValue(e,t){const i=e.params,s=this.getCallee(i.objectHandler,i.callChain);t(this.wrapResult(s[i.key]))}setValue(e,t){const i=e.params;this.getCallee(i.objectHandler,i.callChain)[i.key]=i.value,t(void 0)}hasProperty(e,t){const i=e.params,s=this.getCallee(i.objectHandler,i.callChain);t(this.wrapResult(s&&s.hasOwnProperty(i.key)))}deleteProperty(e,t){const i=e.params,s=this.getCallee(i.objectHandler,i.callChain);s&&delete s[i.key],t(1)}getCallee(e,t){var i,o,n,r;let a=null!==(i=this.objectRefs[e])&&void 0!==i?i:s.MPEnv.platformGlobal();"engineScope"===t[0]&&(a=this.engineScope,t.shift());for(let e=0;e<t.length;e++){const i=t[e];if(a=a[i],"document"===i&&0===e&&void 0===a&&(a=null===(r=null===(n=null===(o=this.engine)||void 0===o?void 0:o.managedViews)||void 0===n?void 0:n[0])||void 0===r?void 0:r.document),null==a)break}return a}wrapArgument(e,t){if("string"==typeof e&&0===e.indexOf("func:")){const i=e,s=this;return function(){let e=[];for(let t=0;t<arguments.length;t++){const i=arguments[t];e.push(s.wrapResult(i))}t(i,e)}}if("string"==typeof e&&0===e.indexOf("obj:"))return this.objectRefs[e.replace("obj:","")];if("object"==typeof e&&e instanceof Array)return e.map((e=>this.wrapArgument(e,t)));if("object"==typeof e){let i={};for(const s in e)i[s]=this.wrapArgument(e[s],t);return i}return e}wrapResult(e){if("string"==typeof e||"number"==typeof e||"boolean"==typeof e||"bigint"==typeof e)return e;if("object"==typeof e&&e instanceof Array)return e.map((e=>this.wrapResult(e)));{const t=Math.random().toString();return this.objectRefs[t]=e,{objectHandler:t}}}}},{"../env":40}],45:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Page=void 0;const s=e("./components/dom_utils"),o=e("./components/mpkit/scaffold"),n=e("./env"),r=e("./router");i.Page=class{constructor(e,t,i,s=(null===self||void 0===self?void 0:self.document)){this.element=e,this.engine=t,this.options=i,this.document=s,this._active=!0,this.viewId=-1,this.overlaysView=[],this.isFirst=!1,this.bodyElement=n.MPEnv.platformType===n.PlatformType.browser?e:s.createElement("wx-view"),this.overlayElement=n.MPEnv.platformType===n.PlatformType.browser?e:s.createElement("wx-view"),this.bodyElement===e&&this.overlayElement===e||(this.element.appendChild(this.bodyElement),this.element.appendChild(this.overlayElement)),this.requestRoute().then((e=>{var i;this.viewId=e,t.managedViews[this.viewId]=this,t.pageMode=!0,t.unmanagedViewFrameData[this.viewId]&&(t.unmanagedViewFrameData[this.viewId].forEach((e=>{this.didReceivedFrameData(e)})),delete t.unmanagedViewFrameData[this.viewId]),null===(i=this.readyCallback)||void 0===i||i.call(this,void 0)}))}ready(){return __awaiter(this,void 0,void 0,(function*(){return new Promise((e=>{this.readyCallback=e}))}))}requestRoute(){var e,t,i,s,o,n;return __awaiter(this,void 0,void 0,(function*(){this.engine.app||(this.engine.router=new r.Router(this.engine));const a=null!==(t=null===(e=this.engine.app)||void 0===e?void 0:e.router)&&void 0!==t?t:null===(i=this.engine)||void 0===i?void 0:i.router,l=yield this.fetchViewport();return a.requestRoute(null!==(o=null===(s=this.options)||void 0===s?void 0:s.route)&&void 0!==o?o:"/",null===(n=this.options)||void 0===n?void 0:n.params,this.isFirst||void 0===this.engine.app,{width:l.width,height:l.height})}))}fetchViewport(){return __awaiter(this,void 0,void 0,(function*(){let e=Object.assign({},yield this.element.getBoundingClientRect());return(!e.width||e.width<=.1)&&(n.MPEnv.platformType===n.PlatformType.wxMiniProgram||n.MPEnv.platformType===n.PlatformType.swanMiniProgram?e.width=n.MPEnv.platformScope.getSystemInfoSync().windowWidth:e.width=window.innerWidth),(!e.height||e.height<=.1)&&(n.MPEnv.platformType===n.PlatformType.wxMiniProgram||n.MPEnv.platformType===n.PlatformType.swanMiniProgram?e.height=n.MPEnv.platformScope.getSystemInfoSync().windowHeight:e.height=window.innerHeight),e}))}dispose(){delete this.engine.managedViews[this.viewId]}viewportChanged(){var e,t,i;return __awaiter(this,void 0,void 0,(function*(){const s=null!==(t=null===(e=this.engine.app)||void 0===e?void 0:e.router)&&void 0!==t?t:null===(i=this.engine)||void 0===i?void 0:i.router;if(s){const e=yield this.fetchViewport();s.updateRoute(this.viewId,{width:e.width,height:e.height})}}))}didReceivedFrameData(e){return __awaiter(this,void 0,void 0,(function*(){if((!e.overlays||e.overlays&&e.overlays instanceof Array&&0===e.overlays.length)&&this.overlaysView.length>0&&(this.overlaysView.forEach((e=>{e.htmlElement.style.visibility="hidden"})),yield this.removeOverlays()),!0!==e.ignoreScaffold){const t=this.engine.componentFactory.create(e.scaffold,this.document);if(!(t instanceof o.MPScaffold))return;this.scaffoldView!==t&&(this.scaffoldView&&(this.scaffoldView.htmlElement.remove(),this.scaffoldView.removeFromSuperview()),this.scaffoldView=t,t instanceof o.MPScaffold&&!t.delegate&&(n.MPEnv.platformType===n.PlatformType.wxMiniProgram||n.MPEnv.platformType===n.PlatformType.swanMiniProgram)&&(t.setDelegate(new a(this.document,this.miniProgramPage)),t.setAttributes(e.scaffold.attributes))),this.scaffoldView&&this.active&&!this.scaffoldView.attached&&(this.scaffoldView.attached=!0,this.bodyElement.appendChild(this.scaffoldView.htmlElement),(0,s.setDOMStyle)(this.scaffoldView.htmlElement,{display:"contents"}))}e.overlays&&e.overlays instanceof Array&&this.setOverlays(e.overlays)}))}onRefresh(){return __awaiter(this,void 0,void 0,(function*(){this.scaffoldView instanceof o.MPScaffold&&(yield this.scaffoldView.onRefresh())}))}onWechatMiniProgramShareAppMessage(){return __awaiter(this,void 0,void 0,(function*(){if(this.scaffoldView instanceof o.MPScaffold)return yield this.scaffoldView.onWechatMiniProgramShareAppMessage()}))}onReachBottom(){this.scaffoldView instanceof o.MPScaffold&&this.scaffoldView.onReachBottom()}onPageScroll(e){this.scaffoldView instanceof o.MPScaffold&&this.scaffoldView.onPageScroll(e)}removeOverlays(){return __awaiter(this,void 0,void 0,(function*(){return new Promise((e=>{this.overlaysView.forEach((e=>{e.htmlElement.remove(),e.removeFromSuperview()})),this.overlaysView=[],setTimeout((()=>{e(null)}),100)}))}))}setOverlays(e){let t=e.map((e=>this.engine.componentFactory.create(e,this.document))).filter((e=>e));t.length===this.overlaysView.length&&t.every(((e,i)=>t[i]===this.overlaysView[i]))||(this.overlaysView.forEach((e=>{e.htmlElement.remove(),e.removeFromSuperview()})),t.forEach((e=>{this.overlayElement.appendChild(e.htmlElement)})),this.overlaysView=t)}get active(){return this._active}set active(e){var t;this._active=e,e?(null===(t=this.scaffoldView)||void 0===t?void 0:t.htmlElement)&&(this.element.appendChild(this.scaffoldView.htmlElement),this.scaffoldView.setAttributes(this.scaffoldView.attributes)):this.scaffoldView&&(this.scaffoldView.attached=!1,this.scaffoldView.htmlElement.remove())}};class a{constructor(e,t){this.document=e,this.miniProgramPage=t,this.backgroundElement=this.document.createElement("div"),this.backgroundElementAttached=!1}setPageTitle(e){n.MPEnv.platformType!==n.PlatformType.swanMiniProgram?(n.MPEnv.platformPC()&&n.MPEnv.platformScope.setNavigationBarTitle({title:e}),this.miniProgramPage.setData({"pageMeta.naviBar.title":e})):n.MPEnv.platformScope.setNavigationBarTitle({title:e})}setPageBackgroundColor(e){if("transparent"===e)return this.backgroundElement.remove(),void(this.backgroundElementAttached=!1);(0,s.setDOMStyle)(this.backgroundElement,{position:"fixed",width:"100vw",height:"100vh",zIndex:"-1",backgroundColor:e}),this.backgroundElementAttached||(this.document.body.appendChild(this.backgroundElement),this.backgroundElementAttached=!0)}setAppBarColor(e,t){n.MPEnv.platformType!=n.PlatformType.swanMiniProgram?(n.MPEnv.platformPC()&&n.MPEnv.platformScope.setNavigationBarColor({frontColor:t,backgroundColor:e}),this.miniProgramPage.setData({"pageMeta.naviBar.backgroundColor":e,"pageMeta.naviBar.frontColor":t})):n.MPEnv.platformScope.setNavigationBarColor({frontColor:t,backgroundColor:e})}}},{"./components/dom_utils":29,"./components/mpkit/scaffold":34,"./env":40,"./router":46}],46:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Router=void 0;class s{constructor(e){this.engine=e,this.routeResponseHandler={}}static clearBeingPushTimeout(){this.beingPushTimeout&&(clearTimeout(this.beingPushTimeout),this.beingPushTimeout=void 0)}updateRoute(e,t){return __awaiter(this,void 0,void 0,(function*(){this.engine.sendMessage(JSON.stringify({type:"router",message:{event:"updateRoute",routeId:e,viewport:t}}))}))}requestRoute(e,t,i,s){return __awaiter(this,void 0,void 0,(function*(){if(this.thePushingRouteId){let e=this.thePushingRouteId;return this.thePushingRouteId=void 0,this.engine.sendMessage(JSON.stringify({type:"router",message:{event:"updateRoute",routeId:e,viewport:s}})),e}let o=Math.random().toString();return new Promise((n=>{this.routeResponseHandler[o]=n,this.engine.sendMessage(JSON.stringify({type:"router",message:{event:"requestRoute",requestId:o,name:e,params:null!=t?t:{},viewport:s,root:!0===i}}))}))}))}responseRoute(e){var t;let i=e.requestId,s=e.routeId;null===(t=this.routeResponseHandler[i])||void 0===t||t.call(this,s)}disposeRoute(e){this.engine.sendMessage(JSON.stringify({type:"router",message:{event:"disposeRoute",routeId:e}}))}didReceivedRouteData(e){const t=e.event;"responseRoute"===t?this.responseRoute(e):"didPush"===t?this.didPush(e):"didReplace"===t?this.didReplace(e):"didPop"===t&&this.didPop()}didPush(e){throw"native implementation"}didReplace(e){throw"native implementation"}didPop(){throw"native implementation"}}i.Router=s,s.beingPush=!1},{}],47:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TextMeasurer=void 0;const s=e("./components/component_factory"),o=e("./components/dom_utils"),n=e("./env"),r=e("./router");i.TextMeasurer=class{static delay(){return __awaiter(this,void 0,void 0,(function*(){return new Promise((e=>{setTimeout((()=>{e(null)}),300)}))}))}static didReceivedDoMeasureData(e,t){return __awaiter(this,void 0,void 0,(function*(){for(this.activeTextMeasureDocument||(this.activeTextMeasureDocument=document);r.Router.beingPush;)yield this.delay();if(t.items){s.ComponentFactory.disableCache=!0;const i=t.items.map((t=>e.componentFactory.create(t,this.activeTextMeasureDocument))).filter((e=>e));s.ComponentFactory.disableCache=!1;(yield Promise.all(i.map((e=>__awaiter(this,void 0,void 0,(function*(){var t,i,s,r,a,l,d,c;(0,o.setDOMStyle)(e.htmlElement,{position:"fixed",top:"0px",left:"0px",opacity:"0",width:"unset",maxWidth:(null===(t=e.attributes)||void 0===t?void 0:t.maxWidth)&&"Infinity"!==(null===(i=e.attributes)||void 0===i?void 0:i.maxWidth)?(null===(s=e.attributes)||void 0===s?void 0:s.maxWidth)+"px":"999999px",height:"unset",maxHeight:(null===(r=e.attributes)||void 0===r?void 0:r.maxHeight)&&"Infinity"!==(null===(a=e.attributes)||void 0===a?void 0:a.maxHeight)?(null===(l=e.attributes)||void 0===l?void 0:l.maxHeight)+"px":"999999px"}),this.activeTextMeasureDocument.body.appendChild(e.htmlElement),n.MPEnv.platformType!==n.PlatformType.wxMiniProgram&&n.MPEnv.platformType!==n.PlatformType.swanMiniProgram||(yield this.delay());const h=yield e.htmlElement.getBoundingClientRect();return e.htmlElement.remove(),{measureId:e.attributes.measureId,width:Math.ceil(null!==(d=null==h?void 0:h.width)&&void 0!==d?d:0)+1,height:Math.ceil(null!==(c=null==h?void 0:h.height)&&void 0!==c?c:0)+1}})))))).forEach((t=>{e.componentFactory.callbackTextMeasureResult(t.measureId,t)}))}}))}}},{"./components/component_factory":26,"./components/dom_utils":29,"./env":40,"./router":46}],48:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.WindowInfo=void 0;const s=e("./env");i.WindowInfo=class{constructor(e){this.engine=e}updateWindowInfo(){var e;s.MPEnv.platformType===s.PlatformType.wxMiniProgram||s.MPEnv.platformType===s.PlatformType.swanMiniProgram?this.engine.sendMessage(JSON.stringify({type:"window_info",message:{window:{width:s.MPEnv.platformScope.getSystemInfoSync().screenWidth,height:s.MPEnv.platformScope.getSystemInfoSync().screenHeight,padding:{top:s.MPEnv.platformScope.getSystemInfoSync().statusBarHeight,bottom:s.MPEnv.platformScope.getSystemInfoSync().screenHeight-(null===(e=s.MPEnv.platformScope.getSystemInfoSync().safeArea)||void 0===e?void 0:e.bottom)}},devicePixelRatio:s.MPEnv.platformScope.getSystemInfoSync().pixelRatio}})):this.engine.sendMessage(JSON.stringify({type:"window_info",message:{window:{width:document.body.clientWidth,height:window.innerHeight,padding:{top:0,bottom:0}},devicePixelRatio:devicePixelRatio}}))}}},{"./env":40}],49:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.WXPage=i.WXApp=void 0;const s=e("./env"),o=e("./page"),n=e("./router"),r=e("./text_measurer"),a={router:{},runtime:{subpackagesMap:{},tabBarMap:{},usingComponents:{}},pages:{index:{}},redirect:{},optimization:{domSubTreeLevel:10,elementMultiplexing:!0,textMultiplexing:!0,commentMultiplexing:!0,domExtendMultiplexing:!0,styleValueReduce:5e3,attrValueReduce:5e3}};i.WXApp=class{constructor(e,t){this.indexPage=e,this.engine=t,this.router=new l(this.engine),t.app=this}};i.WXPage=function(e,t="#vdom",i=s.MPEnv.platformGlobal().app){return{data:{pageMeta:{naviBar:{}}},kboneRender:void 0,kboneDocument:void 0,kbonePageId:void 0,prepare(){const e=this.kboneRender.createPage(this.route,a);this.kbonePageId=e.pageId;const t=e.window;this.kboneDocument=e.document,this.kboneDocument.window=t,t.$$createSelectorQuery=()=>s.MPEnv.platformScope.createSelectorQuery().in(this),t.$$createIntersectionObserver=e=>s.MPEnv.platformScope.createIntersectionObserver(this,e),this.setData({pageId:this.kbonePageId})},onLoad(t){this.prepare();const s=this.kboneDocument,a=this.kboneDocument;r.TextMeasurer.activeTextMeasureDocument=a,n.Router.clearBeingPushTimeout(),n.Router.beingPush=!1;const l=(()=>{let e=i.indexPage.split("/");return e.pop(),e.join("/")})();let d=e;if(!e||t.route){let e=Object.assign({},t);delete e.route,t.route?d={route:t.route,params:e}:(d={route:this.route.replace(l,""),params:e},"/index"===d.route&&(d.route="/"))}(null==d?void 0:d.route)&&(d.route=decodeURIComponent(d.route)),this.mpPage=new o.Page(s.body,i.engine,d,s),this.mpPage.miniProgramPage=this,this.mpPage.isFirst=1===getCurrentPages().length},onUnload(){this.mpPage.viewId&&i.router.disposeRoute(this.mpPage.viewId)},onShow(){var e;r.TextMeasurer.activeTextMeasureDocument=null!==(e=this.kboneDocument)&&void 0!==e?e:this.selectComponent(t+"_tm").miniDom.document,n.Router.clearBeingPushTimeout(),n.Router.beingPush=!1},onPullDownRefresh(){this.mpPage.onRefresh().then((e=>{s.MPEnv.platformScope.stopPullDownRefresh()}))},onShareAppMessage(){return{promise:this.mpPage.onWechatMiniProgramShareAppMessage()}},onReachBottom(){this.mpPage.onReachBottom()},onPageScroll(e){this.mpPage.onPageScroll(e.scrollTop),this.kboneDocument.window.scrollY=e.scrollTop,this.kboneDocument.window.scrollY=e.scrollTop,this.kboneDocument.window.scrollY=e.scrollTop,this.kboneDocument.window.$$trigger("scroll",e.scrollTop)}}};class l extends n.Router{encodeRelativePath(e,t){let i=[];if(t)for(const e in t)i.push(`${e}=${encodeURIComponent(t[e])}`);return i.length>0?`${0===e.indexOf("/")?e.substr(1):e}?${i.join("&")}`:`${0===e.indexOf("/")?e.substr(1):e}`}encodeIndexPath(e,t){let i=[];if(t)for(const e in t)i.push(`${e}=${encodeURIComponent(t[e])}`);const s=e.indexOf("?")>=0?e.split("?")[0]:e,o=e.indexOf("?")>=0?e.substr(e.indexOf("?")):"";return i.length>0?`/${this.engine.app.indexPage}?route=${encodeURI(s)}${encodeURIComponent(o)}&${i.join("&")}`:`/${this.engine.app.indexPage}?route=${encodeURI(s)}${encodeURIComponent(o)}`}didPush(e){n.Router.clearBeingPushTimeout(),n.Router.beingPush=!0;const t=e.routeId;this.thePushingRouteId=t;const i=e.name;s.MPEnv.platformScope.navigateTo({url:this.encodeRelativePath(i,e.params),fail:()=>{s.MPEnv.platformScope.navigateTo({url:this.encodeIndexPath(i,e.params)})}}),n.Router.beingPushTimeout=setTimeout((()=>{n.Router.beingPush=!1}),1e3)}didReplace(e){n.Router.clearBeingPushTimeout(),n.Router.beingPush=!0;const t=e.routeId;this.thePushingRouteId=t;const i=e.name;s.MPEnv.platformScope.redirectTo({url:this.encodeRelativePath(i,e.params),fail:()=>{s.MPEnv.platformScope.redirectTo({url:this.encodeIndexPath(i,e.params)})}}),n.Router.beingPushTimeout=setTimeout((()=>{n.Router.beingPush=!1}),1e3)}didPop(){n.Router.clearBeingPushTimeout(),n.Router.beingPush=!0,s.MPEnv.platformScope.navigateBack(),n.Router.beingPushTimeout=setTimeout((()=>{n.Router.beingPush=!1}),1e3)}}},{"./env":40,"./page":45,"./router":46,"./text_measurer":47}]},{},[42])(42)}));
